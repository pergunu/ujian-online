<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Pergunu - Sistem Ujian Lengkap</title>
    <!-- Favicon -->
    <link rel="icon" href="https://raw.githubusercontent.com/pergunu/quiz-pergunu/main/assets/images/logo.png" type="image/png">
    
    <!-- Font & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Great+Vibes&family=Dancing+Script:wght@400;700&family=Alex+Brush&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Library untuk screenshot -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --secondary-light: #ff70a6;
            --secondary-dark: #b5179e;
            --success: #4cc9f0;
            --success-light: #56cfe1;
            --success-dark: #4895ef;
            --warning: #f8961e;
            --danger: #ef233c;
            --light: #f8f9fa;
            --lighter: #e9ecef;
            --dark: #212529;
            --darker: #1a1a1a;
            --gray: #6c757d;
            --light-gray: #dee2e6;
            --radius: 16px;
            --radius-sm: 10px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 10px 20px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 20px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-dark));
            --gradient-success: linear-gradient(135deg, var(--success), var(--success-dark));
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background: var(--lighter);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            background-image: radial-gradient(circle at 10% 20%, rgba(67, 97, 238, 0.05) 0%, rgba(67, 97, 238, 0.05) 90%);
            overflow-x: hidden;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            z-index: 9998;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 2rem;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            padding: 2.5rem;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(67, 97, 238, 0.3);
            color: #333;
        }

        .login-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
            font-family: 'Playfair Display', serif;
        }

        .login-description {
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 2rem;
            color: #444;
        }

        .login-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.15);
        }

        .login-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
            font-size: 1.1rem;
            width: 100%;
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.6);
        }

        /* Star Animation */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
            opacity: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: var(--opacity); transform: scale(1); }
        }

        /* Opening Animation */
        .opening-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            z-index: 9999;
            display: none; /* Changed from flex to none */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }

        .opening-logo {
            width: 150px;
            height: 150px;
            margin-bottom: 2rem;
            animation: pulse 2s infinite, float 3s ease-in-out infinite;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            object-fit: contain;
            background: white;
            padding: 5px;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        .opening-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            font-family: 'Playfair Display', serif;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.8s ease-out;
            background: linear-gradient(to right, #fff, #f8f9fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
            position: relative;
        }

        .opening-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
            border-radius: 2px;
        }

        .opening-subtitle {
            font-size: 1.5rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            opacity: 0.9;
            animation: slideUp 0.8s ease-out 0.3s forwards;
            opacity: 0;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* Improved Terms Container */
        .terms-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            padding: 2.5rem;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(67, 97, 238, 0.3);
            animation: fadeIn 1s ease-out 5s forwards;
            opacity: 0;
            color: #333;
            backdrop-filter: blur(10px);
            margin: 1rem auto;
            font-size: 1.05rem;
            line-height: 1.8;
        }

        .terms-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
            text-align: center;
            font-family: 'Playfair Display', serif;
            position: relative;
            padding-bottom: 15px;
        }

        .terms-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 3px;
        }

        .terms-content {
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: #444;
            padding: 0 1.5rem;
        }

        .terms-content p {
            margin-bottom: 1.25rem;
        }

        .terms-content strong {
            color: var(--primary-dark);
            font-weight: 600;
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2rem;
            color: var(--dark);
            padding: 0 1.5rem;
            font-size: 1.05rem;
        }

        .terms-checkbox input {
            margin-right: 0.75rem;
            width: 1.3rem;
            height: 1.3rem;
            accent-color: var(--primary);
        }

        /* Improved Continue Button */
        .continue-btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem 3rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            margin: 2rem auto 0;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
            display: inline-block;
            animation: pulse 2s infinite;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.6);
            background: var(--primary-dark);
        }

      .continue-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--light-gray);
    color: var(--gray);
    border-color: var(--light-gray);
    transform: none !important;
    box-shadow: none !important;
}

.continue-btn:not(:disabled) {
    display: block !important;
}

        .continue-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }

        .continue-btn:hover::after {
            left: 100%;
        }

        /* Improved Opening Message */
        .opening-message {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
            margin: 2rem auto 5rem;
            line-height: 1.8;
            font-style: italic;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            max-width: 600px;
            animation: fadeIn 1s ease-out 1.5s forwards;
            opacity: 0;
            text-align: center;
            position: relative;
            padding: 0 30px;
        }

        .opening-message::before,
        .opening-message::after {
            font-size: 1.5rem;
            line-height: 0;
            vertical-align: middle;
            color: rgba(255,255,255,0.3);
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }

        .opening-message::before {
            content: open-quote;
            left: 0;
        }

        .opening-message::after {
            content: close-quote;
            right: 0;
            bottom: auto;
        }

        .opening-message span {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.9em;
        }

        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }

        @keyframes spin {
    to { transform: rotate(360deg); }
}
        /* Main Content - FULL SCREEN LAYOUT */
        .main-container {
            width: 100%;
            min-height: 100vh;
            padding: 0;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 1s ease-out;
            position: relative;
        }

        /* Participant Form - Improved Full Screen Design */
        .participant-form {
            background: white;
            border-radius: 0;
            box-shadow: none;
            padding: 2rem 1.5rem;
            width: 100%;
            height: 100vh;
            margin: 0;
            position: relative;
            overflow: auto;
            border: none;
            animation: fadeInUp 0.8s ease-out;
            background-image: linear-gradient(to bottom right, rgba(248, 249, 250, 0.8), rgba(233, 236, 239, 0.9));
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .participant-form::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(67, 97, 238, 0.05) 0%, transparent 70%);
            z-index: 0;
        }

        .form-header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 1;
        }

        .form-logo {
            width: 140px;
            height: 140px;
            object-fit: contain;
            margin: 0 auto 1.5rem;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 0 0 6px var(--primary-light), 0 15px 35px rgba(67, 97, 238, 0.25);
            transition: var(--transition);
            display: block;
            background: white;
            padding: 10px;
        }

        .form-logo:hover {
            transform: scale(1.08) rotate(5deg);
            box-shadow: 0 0 0 6px var(--primary-light), 0 20px 40px rgba(67, 97, 238, 0.35);
        }

        .form-title {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .form-title::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 5px;
            background: var(--gradient-primary);
            border-radius: 3px;
        }

        .form-subtitle {
            font-size: 1.1rem;
            color: var(--gray);
            margin-top: 1.5rem;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .form-group {
            margin-bottom: 1.75rem;
            animation: fadeIn 0.5s ease-out;
            animation-fill-mode: backwards;
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        .form-group:nth-child(1) { animation-delay: 0.2s; }
        .form-group:nth-child(2) { animation-delay: 0.3s; }
        .form-group:nth-child(3) { animation-delay: 0.4s; }
        .form-group:nth-child(4) { animation-delay: 0.5s; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Controls */
        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 500;
            color: var(--darker);
            font-size: 1rem;
            position: relative;
            padding-left: 10px;
        }

        .form-label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 16px;
            background: var(--primary);
            border-radius: 2px;
        }
        
        .form-control {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            color: var(--dark);
            box-shadow: var(--shadow);
            margin-bottom: 0.5rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.15);
            background: white;
        }
        
        /* Kategori Tabs */
        .category-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .category-tab {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-sm);
            background: var(--lighter);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            text-align: center;
            flex: 1;
            min-width: 120px;
            border: 1px solid var(--light-gray);
            color: var(--gray);
            box-shadow: var(--shadow);
        }
        
        .category-tab:hover {
            background: var(--light-gray);
            color: var(--dark);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .category-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.25);
            transform: translateY(-3px);
        }

        /* Disabled state styles */
.category-tab.disabled, 
.subcategory-label.disabled {
    position: relative;
    transition: all 0.3s ease;
}

[data-tooltip] {
    position: relative;
}

/* Continue Button Styles */
.continue-btn {
    background: var(--primary);
    color: white;
    padding: 1rem 2rem;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin: 2rem auto 0;
    width: 100%;
    max-width: 300px;
    box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
}

.continue-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
}

.continue-btn:disabled {
    background: var(--light-gray);
    color: var(--gray);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.continue-btn .spinner {
    display: none;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}
/* ####################### PASTE CSS BARU SELESAI DI SINI ####################### */
</style> <!-- Ini adalah penutup tag style -->
        
        /* Subkategori Container */
        .subcategory-container {
            margin-top: 1.5rem;
            padding: 1.75rem;
            background: white;
            border-radius: var(--radius-sm);
            border: 1px solid var(--light-gray);
            animation: fadeIn 0.3s ease-out;
            box-shadow: var(--shadow);
        }
        
        .subcategory-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.15rem;
            justify-content: center;
        }
        
        .subcategory-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.75rem;
        }
        
        .subcategory-option {
            display: inline-block;
        }
        
        .subcategory-radio {
            display: none;
        }
        
        .subcategory-label {
            display: inline-block;
            padding: 0.8rem 1rem;
            background: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.95rem;
            transition: var(--transition);
            border: 1px solid var(--light-gray);
            text-align: center;
            box-shadow: var(--shadow);
            width: 100%;
        }
        
        .subcategory-radio:checked + .subcategory-label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.25);
            transform: translateY(-3px);
        }
        
        .subcategory-label:hover {
            background: var(--lighter);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .subcategory-label.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        /* Profesi Field (khusus umum) */
        .profesi-field {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        /* Level Select */
        #level {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            color: var(--dark);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1.25rem center;
            background-size: 1.25em;
            box-shadow: var(--shadow);
        }

        #level:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.15);
            background: white;
        }

        /* Start Quiz Button */
        #startQuiz {
            width: 100%;
            padding: 1.25rem;
            font-size: 1.2rem;
            margin-top: 1.5rem;
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        #startQuiz:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(67, 97, 238, 0.4);
        }

        #startQuiz::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0) 60%
            );
            transform: rotate(30deg);
            transition: var(--transition);
        }

        #startQuiz:hover::before {
            left: 100%;
        }

        /* Quiz Container - FULL SCREEN LAYOUT */
        .quiz-container {
            background: white;
            border-radius: 0;
            box-shadow: none;
            padding: 2.5rem 1.5rem;
            width: 100%;
            height: 100vh;
            margin: 0;
            display: none;
            animation: fadeIn 0.5s ease-out;
            position: relative;
            overflow: auto;
            background-image: linear-gradient(to bottom right, rgba(248, 249, 250, 0.8), rgba(233, 236, 239, 0.9));
        }
        
        .quiz-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: var(--gradient-primary);
        }
        
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            flex-wrap: wrap;
            gap: 1.5rem;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .quiz-title {
            font-size: 1.75rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 1rem;
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .quiz-info {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .quiz-info-item {
            background: var(--lighter);
            padding: 0.75rem 1.25rem;
            border-radius: 2rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            color: var(--dark);
            border: 1px solid var(--light-gray);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .quiz-info-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .quiz-info-item i {
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        /* Question */
        .question-container {
            margin-bottom: 2.5rem;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .question-number {
            display: inline-block;
            background: var(--lighter);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            color: var(--gray);
            font-weight: 500;
            box-shadow: var(--shadow);
        }
        
        .question-text {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            line-height: 1.7;
            color: var(--darker);
            font-weight: 500;
        }
        
        /* Options */
        .options-container {
            display: grid;
            gap: 1.25rem;
            margin-bottom: 2.5rem;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .option {
            padding: 1.5rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1.25rem;
            background: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .option:hover {
            background: var(--lighter);
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
            transform: translateY(-5px);
            pointer-events: none;
        }
        
        .option.selected .option-prefix {
            color: white;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .option.correct {
            background: var(--success);
            color: white;
            border-color: var(--success-dark);
            box-shadow: 0 8px 20px rgba(76, 201, 240, 0.3);
            pointer-events: none;
        }
        
        .option.incorrect {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            box-shadow: 0 8px 20px rgba(239, 35, 60, 0.3);
            pointer-events: none;
        }
        
        .option-prefix {
            font-weight: 700;
            width: 2.25rem;
            height: 2.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--lighter);
            color: var(--primary);
            transition: var(--transition);
            flex-shrink: 0;
            box-shadow: var(--shadow);
        }
        
        /* Explanation */
        .explanation {
            margin-top: 2.5rem;
            padding: 2rem;
            background: white;
            border-radius: var(--radius-sm);
            border-left: 5px solid var(--primary);
            display: none;
            animation: fadeIn 0.5s ease-out;
            box-shadow: var(--shadow);
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .explanation-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.25rem;
        }
        
        .explanation-text {
            color: var(--dark);
            line-height: 1.8;
        }
        
        /* Navigation Buttons */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.1rem;
            box-shadow: var(--shadow);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }
        
        .btn-secondary {
            background: var(--lighter);
            color: var(--dark);
            border: 1px solid var(--light-gray);
        }
        
        .btn-secondary:hover {
            background: var(--light-gray);
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
            box-shadow: 0 6px 15px rgba(76, 201, 240, 0.3);
        }
        
        .btn-success:hover {
            background: var(--success-dark);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(76, 201, 240, 0.4);
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
            box-shadow: 0 6px 15px rgba(248, 150, 30, 0.3);
        }
        
        .btn-warning:hover {
            background: #e07e0c;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(248, 150, 30, 0.4);
        }

        .continue-btn {
    transition: all 0.3s ease;
    margin: 2rem auto 0;
}

.continue-btn:disabled {
    opacity: 0.5;
    pointer-events: none;
    cursor: not-allowed;
}

.continue-btn:not(:disabled) {
    opacity: 1;
    pointer-events: auto;
    cursor: pointer;
}
        
        /* Certificate Styles - REVISED PROFESSIONAL DESIGN */
    .certificate-wrapper {
    position: relative;
    width: 100%;
    max-width: 800px;
    margin: 2rem auto;
    text-align: center;
    background-image: url('https://raw.githubusercontent.com/pergunu/quiz-pergunu/main/assets/images/certificate.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    min-height: 1122px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 80px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    border-radius: 15px;
    overflow: hidden;
    border: 1px solid #e0e0e0;
}

.certificate-header {
    margin-bottom: 1rem;
    position: relative;
    order: 1; /* Menentukan urutan tampilan */
}

.certificate-watermark {
    position: absolute;
    top: 20px;
    left: 0;
    width: 100%;
    text-align: center;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
    color: rgba(67, 97, 238, 0.8);
    letter-spacing: 1px;
    font-weight: bold;
    padding: 0.5rem;
    text-transform: uppercase;
    font-weight: 700;
    order: 1; /* Posisi paling atas */
}

.certificate-title {
    font-size: 2.8rem;
    color: #3a0ca3;
    margin: 4rem 0 0.5rem;
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    position: relative;
    display: inline-block;
    order: 2;
}

.certificate-subtitle {
    font-size: 1.1rem;
    color: #555;
    margin: 1rem 0;
    font-weight: 500;
    letter-spacing: 1px;
    text-transform: uppercase;
    order: 3;
}

.certificate-name {
    font-size: 3.5rem;
    font-weight: 700;
    color: #3a0ca3;
    margin: 1.5rem 0;
    font-family: 'Alex Brush', cursive;
    letter-spacing: 2px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    line-height: 1.2;
    order: 4;
}

.certificate-text {
    font-size: 1.2rem;
    line-height: 1.6;
    margin: 1rem auto;
    color: #333;
    max-width: 700px;
    order: 5;
}

.certificate-score {
    font-size: 5rem;
    font-weight: 700;
    color: #3a0ca3;
    margin: 2rem 0;
    position: relative;
    font-family: 'Montserrat', sans-serif;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    order: 6;
}

.certificate-message {
    font-size: 1.1rem;
    margin: 1rem auto;
    color: #333;
    line-height: 1.6;
    font-weight: 500;
    max-width: 700px;
    font-style: italic;
    padding: 0 2rem;
    order: 7;
}

.certificate-footer {
    margin-top: auto;
    text-align: center;
    padding-top: 2rem;
    order: 9; /* Pindah ke bawah barcode */
}

.certificate-date {
    margin-top: 1rem;
    font-weight: 500;
    color: #555;
    font-size: 1rem;
    order: 8; /* Pindah ke atas barcode */
}

.barcode-container {
    margin-top: 0;
    text-align: center;
    order: 10; /* Posisi paling bawah */
}

.barcode-text {
    font-family: 'Poppins', sans-serif;
    font-size: 0.9rem;
    color: var(--dark);
    font-weight: 600;
    margin-bottom: 1rem; /* Pindahkan ke atas barcode */
    order: 8; /* Sebelum barcode */
}
        /* Print Button */
        .print-certificate-btn {
            display: block;
            width: 300px;
            padding: 1rem 2rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            text-decoration: none;
            box-shadow: var(--shadow);
            color: white;
            background: var(--gray);
            margin: 2rem auto;
            border: none;
        }
        
        .print-certificate-btn:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            background: #5a6268;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .certificate-wrapper, .certificate-wrapper * {
                visibility: visible;
            }
            .certificate-wrapper {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 100px 80px;
                border: none;
                box-shadow: none;
                background-image: url('https://raw.githubusercontent.com/pergunu/quiz-pergunu/main/assets/images/certificate.png');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                page-break-after: always;
                page-break-inside: avoid;
            }
            .print-certificate-btn, .floating-buttons, .results-details, #restartBtn {
                display: none !important;
            }
            @page {
                size: A4 portrait;
                margin: 0;
            }
            body {
                background: white;
                margin: 0;
                padding: 0;
            }
            .certificate-name {
                font-size: 3rem;
            }
            .certificate-score {
                font-size: 4rem;
                margin: 1.5rem 0;
            }
            .certificate-text, .certificate-message {
                font-size: 1rem;
            }
            .certificate-stats {
                font-size: 0.9rem;
                gap: 1rem;
            }
            .certificate-watermark {
                font-size: 0.7rem;
                top: 30px;
            }
            .barcode-container {
                margin-top: 1.5rem;
            }
        }

        /* Results Container - FULL SCREEN LAYOUT */
        .results-container {
            background: white;
            border-radius: 0;
            box-shadow: none;
            padding: 3.5rem 1.5rem;
            width: 100%;
            height: 100vh;
            margin: 0;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s ease-out;
            position: relative;
            overflow: auto;
            background-image: linear-gradient(to bottom right, rgba(248, 249, 250, 0.8), rgba(233, 236, 239, 0.9));
        }
        
        .results-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: var(--gradient-primary);
        }
        
        /* Stats Container */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 3rem;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .stat-item {
            background: var(--lighter);
            padding: 2rem;
            border-radius: var(--radius-sm);
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--light-gray);
            transition: var(--transition);
        }
        
        .stat-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .stat-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-family: 'Playfair Display', serif;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: var(--gray);
            font-weight: 500;
        }
        
        /* Floating Buttons */
        .floating-buttons {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            z-index: 100;
        }
        
        .floating-btn {
            width: 4.5rem;
            height: 4.5rem;
            border-radius: 50%;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            transition: var(--transition);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        
        .floating-btn:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }
        
        .floating-btn .tooltip {
            position: absolute;
            right: 5.5rem;
            background: white;
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            font-size: 0.95rem;
            width: max-content;
            max-width: 250px;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
            text-align: right;
        }
        
        .floating-btn:hover .tooltip {
            opacity: 1;
            right: 6rem;
        }
        
        .call-center-btn {
            background: #25d366;
            animation: pulse 2s infinite;
        }
        
        .call-center-btn:hover {
            background: #128c7e;
            animation: none;
        }
        
        .admin-btn {
            background: var(--secondary);
        }
        
        .admin-btn:hover {
            background: var(--secondary-dark);
        }
        
        .music-btn {
            background: var(--primary);
        }
        
        .music-btn:hover {
            background: var(--primary-dark);
        }
        
        .pergunu-link-btn {
            background: #3a0ca3;
            font-size: 1.5rem;
            text-decoration: none;
            color: white;
        }
        
        .pergunu-link-btn:hover {
            background: #480ca8;
        }
        
        /* Admin Panel */
        .admin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        .admin-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: var(--radius);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            padding: 3rem;
            z-index: 1001;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            display: none;
            animation: fadeIn 0.3s ease-out;
            background-image: linear-gradient(to bottom right, rgba(248, 249, 250, 0.9), rgba(233, 236, 239, 0.95));
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.75rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .admin-title {
            font-size: 2rem;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 1rem;
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            background: linear-gradient(to right, var(--secondary), var(--secondary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .admin-close {
            background: none;
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .admin-close:hover {
            color: var(--secondary);
            transform: rotate(90deg);
            background: var(--lighter);
        }
        
        /* Admin Content */
        .admin-content {
            display: none;
        }
        
        .question-item {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-sm);
            margin-bottom: 1.5rem;
            border: 1px solid var(--light-gray);
            box-shadow: var(--shadow);
        }
        
        .question-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .question-meta span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .question-content {
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .question-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        
        .action-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: white;
            box-shadow: var(--shadow);
        }
        
        .edit-question {
            background: var(--primary);
        }
        
        .delete-question {
            background: var(--danger);
        }
        
        .edit-form {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--light-gray);
        }
        
        .ai-prompt-section {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius-sm);
            margin-bottom: 2rem;
            border: 1px solid var(--light-gray);
            box-shadow: var(--shadow);
        }
        
        .ai-prompt-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.15rem;
        }
        
        .ai-prompt-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        
        .ai-loading {
            display: none;
            margin-bottom: 1rem;
            color: var(--primary);
            font-style: italic;
        }
        
        .ai-generate-btn {
            width: 100%;
        }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 2.5rem;
            height: 2.5rem;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Confetti Effect */
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            top: 100%;
            left: 50%;
            z-index: 1000;
            animation: confetti 3s ease-out forwards;
            opacity: 0.8;
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0) translateX(0); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg) translateX(100px); opacity: 0; }
        }

        /* Responsive adjustments */
        @media (max-width: 992px) {
            .participant-form, .quiz-container, .results-container {
                max-width: 100%;
            }
            
            .stats-container {
                grid-template-columns: 1fr 1fr;
            }
            
            .certificate-wrapper {
                padding: 40px;
            }
            
            .certificate-title {
                font-size: 2.2rem;
            }
            
            .certificate-name {
                font-size: 2rem;
            }
            
            .certificate-score {
                font-size: 4rem;
            }
            
            .certificate-message {
                font-size: 1.1rem;
            }
            
            .certificate-stats {
                gap: 1rem;
            }
            
            .certificate-stat {
                padding: 1rem;
                min-width: 120px;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0;
            }
            
            .participant-form {
                padding: 2.5rem 1.5rem;
            }
            
            .form-logo {
                width: 120px;
                height: 120px;
            }
            
            .form-title {
                font-size: 2.2rem;
            }
            
            .category-tabs {
                gap: 0.75rem;
            }
            
            .category-tab {
                padding: 0.85rem 1rem;
                min-width: 100px;
            }
            
            .subcategory-options {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .quiz-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
            
            .quiz-info {
                width: 100%;
                justify-content: flex-start;
            }
            
            .question-text {
                font-size: 1.3rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .floating-buttons {
                bottom: 1.5rem;
                right: 1.5rem;
            }
            
            .floating-btn {
                width: 4rem;
                height: 4rem;
                font-size: 1.5rem;
            }
            
            .certificate-wrapper {
                padding: 30px;
                min-height: 500px;
            }
            
            .certificate-title {
                font-size: 1.8rem;
            }
            
            .certificate-name {
                font-size: 1.8rem;
            }
            
            .certificate-score {
                font-size: 3.5rem;
            }
            
            .certificate-stats {
                flex-direction: column;
                align-items: center;
            }
            
            .print-certificate-btn {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .participant-form {
                padding: 2rem 1rem;
            }
            
            .form-title {
                font-size: 1.8rem;
            }
            
            .form-subtitle {
                font-size: 1rem;
            }
            
            .subcategory-options {
                grid-template-columns: 1fr 1fr;
            }
            
            .floating-buttons {
                bottom: 1rem;
                right: 1rem;
                gap: 1rem;
            }
            
            .floating-btn {
                width: 3.5rem;
                height: 3.5rem;
                font-size: 1.5rem;
            }
            
            .floating-btn .tooltip {
                right: 4.5rem;
                font-size: 0.85rem;
                padding: 0.5rem 1rem;
            }
            
            .floating-btn:hover .tooltip {
                right: 5rem;
            }
            
            .certificate-wrapper {
                padding: 20px;
                min-height: 400px;
            }
            
            .certificate-title {
                font-size: 1.5rem;
            }
            
            .certificate-subtitle {
                font-size: 1rem;
            }
            
            .certificate-name {
                font-size: 1.5rem;
            }
            
            .certificate-text {
                font-size: 1rem;
            }
            
            .certificate-score {
                font-size: 3rem;
            }
            
            .certificate-message {
                font-size: 1rem;
            }
            
            .barcode-container img {
                height: 60px;
            }
        }

        /* ==================== */
/* VALIDATION STYLES */
/* ==================== */
.validation-error {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffebee;
    color: #c62828;
    padding: 12px 24px;
    border-radius: 4px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.16);
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
    border-left: 4px solid #c62828;
}

.validation-error i {
    font-size: 1.2em;
}

@keyframes slideIn {
    from { 
        opacity: 0;
        transform: translateX(-50%) translateY(-20px); 
    }
    to { 
        opacity: 1;
        transform: translateX(-50%) translateY(0); 
    }
}

/* Disabled state styles */
.category-tab.disabled, 
.subcategory-label.disabled {
    position: relative;
    transition: all 0.3s ease;
}

.category-tab.disabled::after,
.subcategory-label.disabled::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.85);
    z-index: 1;
    border-radius: inherit;
}

[data-tooltip] {
    position: relative;
}

[data-tooltip]::before {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: white;
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s;
    z-index: 10;
    pointer-events: none;
}

[data-tooltip]:hover::before {
    opacity: 1;
    visibility: visible;
}
    <!-- Floating Exam Code Button -->
<div class="floating-exam-code-btn" id="examCodeBtn">
    <i class="fas fa-key"></i>
    <span class="tooltip">Kelola Kode Ujian</span>
</div>

<!-- Exam Code Admin Panel -->
<div class="admin-overlay" id="examCodeOverlay"></div>
<div class="admin-panel exam-code-panel" id="examCodePanel">
    <div class="admin-header">
        <h2 class="admin-title"><i class="fas fa-key"></i> Kontrol Panel Kode Ujian</h2>
        <button class="admin-close" id="examCodeClose">&times;</button>
    </div>
    
    <div class="form-group">
        <label for="currentExamCode" class="form-label">Kode Ujian Saat Ini</label>
        <input type="text" id="currentExamCode" class="form-control" readonly>
    </div>
    
    <div class="form-group">
        <label for="newExamCode" class="form-label">Kode Ujian Baru</label>
        <input type="text" id="newExamCode" class="form-control" 
               placeholder="Masukkan kode ujian baru (min 8 karakter)">
    </div>
    
    <div class="form-group">
        <label for="examCodePassword" class="form-label">Password Admin</label>
        <input type="password" id="examCodePassword" class="form-control" 
               placeholder="Masukkan password admin">
    </div>
    
    <button class="btn btn-primary" id="saveExamCodeBtn">
        <i class="fas fa-save"></i> Simpan Kode Baru
    </button>
    
    <div class="password-form" style="margin-top: 2rem;">
        <h3 class="admin-title"><i class="fas fa-lock"></i> Ganti Password</h3>
        <div class="form-group">
            <label for="currentExamPassword" class="form-label">Password Lama</label>
            <input type="password" id="currentExamPassword" class="form-control" 
                   placeholder="Masukkan password lama">
        </div>
        <div class="form-group">
            <label for="newExamPassword" class="form-label">Password Baru</label>
            <input type="password" id="newExamPassword" class="form-control" 
                   placeholder="Masukkan password baru (min 8 karakter)">
        </div>
        <div class="form-group">
            <label for="confirmExamPassword" class="form-label">Konfirmasi Password</label>
            <input type="password" id="confirmExamPassword" class="form-control" 
                   placeholder="Konfirmasi password baru">
        </div>
        <button class="btn btn-warning" id="changeExamPasswordBtn">
            <i class="fas fa-sync-alt"></i> Ganti Password
        </button>
    </div>
</div>
    </style>
</head>
<body>
    <!-- Star Background -->
    <div class="stars" id="stars"></div>

    <!-- Login Screen -->
   <!-- Ganti seluruh bagian login screen dengan kode berikut -->
<div class="login-screen" id="loginScreen">
    <div class="login-container">
        <h2 class="login-title">Selamat Datang di Ujian Pergunu</h2>
        <p class="login-description">
                Selamat datang di platform ujian kompetensi Pergunu Situbondo. Situs ini dirancang sebagai wadah bagi peserta untuk menguji kemampuan, mengasah wawasan, dan meningkatkan kualitas akademik maupun profesional.
                Untuk memastikan keamanan dan eksklusivitas ujian, silakan masukkan kode sandi ujian terlebih dahulu sebelum melanjutkan. Semoga ujian ini menjadi langkah menuju prestasi dan keberhasilan yang lebih tinggi!
            </p>
        <form id="loginForm">
            <input type="password" id="examCode" class="login-input" 
                   placeholder="Masukkan Kode Login Ujian" required
                   pattern="[A-Za-z0-9-]{12}" 
                   title="Kode harus 12 karakter (huruf/angka/tanda hubung)">
            <div id="loginError" class="error-message" style="display:none;"></div>
            <button type="submit" class="login-btn" id="loginBtn">
                <span id="loginBtnText">Masuk</span>
                <div id="loginSpinner" class="spinner" style="display:none;"></div>
            </button>
        </form>
    </div>
</div>

<style>
/* Tambahkan style ini di bagian CSS */
.error-message {
    color: var(--danger);
    background-color: #ffebee;
    padding: 0.75rem;
    border-radius: var(--radius-sm);
    margin-bottom: 1rem;
    border-left: 4px solid var(--danger);
    display: none;
}

.login-btn {
    position: relative;
}

.spinner {
    display: inline-block;
    width: 1.5rem;
    height: 1.5rem;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
    position: absolute;
    right: 1.5rem;
    top: 50%;
    transform: translateY(-50%);
}
    /* PASTE BARU DARI SINI */
.error-message {
    color: var(--danger);
    background-color: #ffebee;
    padding: 0.75rem;
    border-radius: var(--radius-sm);
    margin-bottom: 1rem;
    border-left: 4px solid var(--danger);
    display: none;
}

.field-error {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 0.25rem;
    display: none;
}

.spinner {
    display: inline-block;
    width: 1.5rem;
    height: 1.5rem;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
}
/* SAMPAI SINI */
</style>

<script>
    // Exam Code Management
let examCode = "p8dy-7xl4-m3dt"; // Default exam code
const DEFAULT_EXAM_PASSWORD = "Pergunu.010499";
let examPassword = DEFAULT_EXAM_PASSWORD;

// Initialize exam code panel
document.getElementById('currentExamCode').value = examCode;
document.getElementById('examCodeBtn').addEventListener('click', showExamCodePanel);
document.getElementById('examCodeClose').addEventListener('click', closeExamCodePanel);
document.getElementById('examCodeOverlay').addEventListener('click', closeExamCodePanel);
document.getElementById('saveExamCodeBtn').addEventListener('click', saveNewExamCode);
document.getElementById('changeExamPasswordBtn').addEventListener('click', changeExamPassword);

function showExamCodePanel() {
    document.getElementById('examCodeOverlay').style.display = 'block';
    document.getElementById('examCodePanel').style.display = 'block';
    document.getElementById('examCodePassword').focus();
}

function closeExamCodePanel() {
    document.getElementById('examCodeOverlay').style.display = 'none';
    document.getElementById('examCodePanel').style.display = 'none';
    document.getElementById('examCodePassword').value = '';
    document.getElementById('newExamCode').value = '';
}

function saveNewExamCode() {
    const password = document.getElementById('examCodePassword').value;
    const newCode = document.getElementById('newExamCode').value.trim();
    
    if (!password || password !== examPassword) {
        alert('Password admin salah!');
        return;
    }
    
    if (!newCode || newCode.length < 8) {
        alert('Kode ujian baru harus minimal 8 karakter!');
        return;
    }
    
    examCode = newCode;
    document.getElementById('currentExamCode').value = examCode;
    document.getElementById('newExamCode').value = '';
    alert('Kode ujian berhasil diperbarui!');
}

function changeExamPassword() {
    const currentPass = document.getElementById('currentExamPassword').value;
    const newPass = document.getElementById('newExamPassword').value;
    const confirmPass = document.getElementById('confirmExamPassword').value;
    
    if (currentPass !== examPassword) {
        alert('Password lama salah!');
        return;
    }
    
    if (newPass !== confirmPass) {
        alert('Password baru dan konfirmasi tidak cocok!');
        return;
    }
    
    if (newPass.length < 8) {
        alert('Password baru harus minimal 8 karakter!');
        return;
    }
    
    examPassword = newPass;
    document.getElementById('currentExamPassword').value = '';
    document.getElementById('newExamPassword').value = '';
    document.getElementById('confirmExamPassword').value = '';
    alert('Password admin berhasil diubah!');
}

// Update login validation to use the examCode variable
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const inputCode = document.getElementById('examCode').value;
    
    if (inputCode !== examCode) {
        alert('Kode ujian tidak valid!');
        return;
    }
    
    // Proceed with login
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('openingScreen').style.display = 'flex';
});
// Ganti event listener login dengan yang berikut
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const loginBtn = document.getElementById('loginBtn');
    const loginBtnText = document.getElementById('loginBtnText');
    const spinner = document.getElementById('loginSpinner');
    const errorDisplay = document.getElementById('loginError');
    
    // Tampilkan loading
    loginBtn.disabled = true;
    loginBtnText.textContent = 'Memeriksa...';
    spinner.style.display = 'block';
    errorDisplay.style.display = 'none';
    
    try {
        // Simulasikan pengecekan ke server (dalam implementasi nyata, ganti dengan fetch/axios)
        const examCode = document.getElementById('examCode').value;
        await new Promise(resolve => setTimeout(resolve, 800)); // Simulasi delay jaringan
        
        // Validasi kode (dalam implementasi nyata, ganti dengan validasi server)
        const validCodes = ['p8dy-7xl4-m3dt', 'test123-456', 'demo-quiz-789'];
        if (!validCodes.includes(examCode)) {
            throw new Error('Kode ujian tidak valid. Silakan coba lagi.');
        }
        
        // Jika valid, lanjutkan
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('openingScreen').style.display = 'flex';
    } catch (error) {
        errorDisplay.textContent = error.message;
        errorDisplay.style.display = 'block';
    } finally {
        loginBtn.disabled = false;
        loginBtnText.textContent = 'Masuk';
        spinner.style.display = 'none';
    }
});
</script>

    <!-- Opening Animation -->
    <div class="opening-screen" id="openingScreen">
        <img src="https://raw.githubusercontent.com/pergunu/quiz-pergunu/main/assets/images/logo.png" alt="Pergunu Logo" class="opening-logo">
        <h1 class="opening-title">Quiz Pergunu</h1>
        <p class="opening-subtitle">Uji Pengetahuan Anda & Raih Prestasi Terbaik Bersama PERGUNU SITUBONDO</p>
        
        <div class="terms-container">
            <h2 class="terms-title">Kebijakan & Persyaratan</h2>
            <div class="terms-content">
                <p>Selamat datang di Quiz Pergunu, platform ujian pengetahuan berbasis web yang dikembangkan oleh Cendhanu (Tim Kreator Digital Pergunu Situbondo). Dengan mengakses dan menggunakan aplikasi ini, Anda menyetujui untuk terikat oleh syarat dan ketentuan berikut:</p>
                
                <p><strong>1. Penggunaan Aplikasi</strong><br>
                 Ujian Pergunu ditujukan untuk tujuan pendidikan dan pengujian pengetahuan. Pengguna diharapkan menggunakan aplikasi ini dengan jujur dan bertanggung jawab.</p>
                
                <p><strong>2. Data Pribadi</strong><br>
               Informasi pribadi yang dikumpulkan (nama, nomor telepon, email) hanya akan digunakan untuk keperluan validasi peserta dan penyampaian hasil ujian. Data tidak akan dibagikan kepada pihak ketiga tanpa izin.</p>
                
                <p><strong>3. Hak Kekayaan Intelektual</strong><br>
                Seluruh konten, termasuk soal quiz, desain antarmuka, dan sistem penilaian merupakan hak milik Pergunu Situbondo. Dilarang melakukan reproduksi, distribusi, atau modifikasi tanpa izin tertulis.</p>
                
                <p><strong>4. Ketentuan Quiz</strong><br>
                Setiap peserta mendapatkan waktu yang telah ditentukan untuk menyelesaikan quiz. Jawaban yang telah dikirim tidak dapat diubah. Sistem penilaian bersifat otomatis dan final.</p>
                
                <p><strong>5. Perilaku Pengguna</strong><br>
                Dilarang keras melakukan kecurangan dalam bentuk apapun selama mengikuti ujian. Pelanggaran akan mengakibatkan pembatalan hasil dan larangan penggunaan aplikasi.</p>
                
                <p><strong>6. Pembaruan Sistem</strong><br>
                Pergunu Situbondo berhak melakukan pembaruan, perbaikan, atau perubahan sistem tanpa pemberitahuan sebelumnya.</p>
                
                <p><strong>7. Tanggung Jawab</strong><br>
                Pengguna bertanggung jawab penuh atas perangkat dan koneksi internet yang digunakan untuk mengakses aplikasi ini.</p>
                
                <p>Dengan melanjutkan, Anda menyatakan telah membaca, memahami, dan menyetujui seluruh ketentuan di atas.</p>
            </div>
            
 <div class="terms-checkbox">
  <input type="checkbox" id="agreeTerms" required>
  <label for="agreeTerms">Saya telah membaca dan menyetujui syarat & ketentuan di atas</label>
</div>

<button class="continue-btn" id="continueBtn" disabled style="display: block;">
  <span id="continueBtnText">Lanjutkan ke Quiz</span> 
  <i class="fas fa-arrow-right"></i>
</button>
        </div>
        
        <p class="opening-message">Ilmu Adalah Cahaya, Kecerdasan & Akhlak Adalah Kunci Kesuksesan (By Cendhanu)</p>
    </div>   
    
    <!-- Main Content -->
    <main class="main-container">
        <!-- Participant Form with integrated header -->
        <!-- Ganti seluruh form peserta dengan yang berikut -->
<form id="participantForm" class="participant-form" novalidate>
    <div class="form-header">
        <img src="https://raw.githubusercontent.com/pergunu/quiz-pergunu/main/assets/images/logo.png" 
             alt="Pergunu Logo" class="form-logo">
        <h2 class="form-title">Quiz Pergunu</h2>
        <p class="form-subtitle">Silakan isi data diri Anda untuk memulai ujian pengetahuan</p>
    </div>
    
    <div id="formErrors" class="error-message" style="display:none; margin-bottom:1.5rem;"></div>
    
    <div class="form-group">
        <label for="name" class="form-label">Nama Lengkap</label>
        <input type="text" id="name" class="form-control" required 
               placeholder="Masukkan nama lengkap Anda"
               minlength="3" maxlength="50">
        <div class="field-error" id="nameError"></div>
    </div>
    
    <div class="form-group">
        <label for="phone" class="form-label">Nomor HP/WhatsApp</label>
        <input type="tel" id="phone" class="form-control" required
               placeholder="Contoh: 6281234567890"
               pattern="^[0-9]{10,14}$"
               title="Nomor HP harus 10-14 digit angka">
        <div class="field-error" id="phoneError"></div>
    </div>
    
    <div class="form-group">
        <label for="email" class="form-label">Email (Opsional)</label>
        <input type="email" id="email" class="form-control" 
               placeholder="Masukkan email Anda"
               pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$">
        <div class="field-error" id="emailError"></div>
    </div>
    
    <!-- ... (kategori dan subkategori tetap sama) ... -->
    
    <button type="submit" class="btn btn-primary" id="startQuiz">
        <i class="fas fa-play"></i> Mulai Quiz
        <div id="formSpinner" class="spinner" style="display:none;"></div>
    </button>
</form>

<style>
/* Tambahkan style ini */
.field-error {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 0.25rem;
    display: none;
}

.participant-form {
    position: relative;
}

.participant-form .spinner {
    position: absolute;
    right: 1.5rem;
    top: 50%;
    transform: translateY(-50%);
    border-top-color: var(--primary);
    border-width: 2px;
    width: 1.25rem;
    height: 1.25rem;
}
    /* Floating Exam Code Button */
.floating-exam-code-btn {
    position: fixed;
    bottom: 2rem;
    left: 2rem;
    width: 4.5rem;
    height: 4.5rem;
    border-radius: 50%;
    background: var(--primary-dark);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    z-index: 100;
    transition: var(--transition);
}

.floating-exam-code-btn:hover {
    transform: scale(1.1);
    background: var(--primary);
}

.exam-code-panel {
    max-width: 500px;
}

/* Hide exam code button when not in login screen */
.main-container ~ .floating-exam-code-btn,
.opening-screen ~ .floating-exam-code-btn {
    display: none;
}
</style>

<script>
// Ganti event listener form peserta dengan yang berikut
document.getElementById('participantForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = e.target;
    const errors = [];
    const errorDisplay = document.getElementById('formErrors');
    const spinner = document.getElementById('formSpinner');
    const submitBtn = document.getElementById('startQuiz');
    
    // Reset error display
    errorDisplay.style.display = 'none';
    document.querySelectorAll('.field-error').forEach(el => el.style.display = 'none');
    
    // Validasi field
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const email = document.getElementById('email').value.trim();
    
    if (!name || name.length < 3) {
        document.getElementById('nameError').textContent = 'Nama harus minimal 3 karakter';
        document.getElementById('nameError').style.display = 'block';
        errors.push('Nama tidak valid');
    }
    
    if (!phone || !/^[0-9]{10,14}$/.test(phone)) {
        document.getElementById('phoneError').textContent = 'Nomor HP harus 10-14 digit angka';
        document.getElementById('phoneError').style.display = 'block';
        errors.push('Nomor HP tidak valid');
    }
    
    if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        document.getElementById('emailError').textContent = 'Format email tidak valid';
        document.getElementById('emailError').style.display = 'block';
        errors.push('Email tidak valid');
    }
    
    if (errors.length > 0) {
        errorDisplay.textContent = 'Terdapat kesalahan dalam form: ' + errors.join(', ');
        errorDisplay.style.display = 'block';
        return;
    }
    
    // Jika valid, proses form
    submitBtn.disabled = true;
    spinner.style.display = 'block';
    
    // Simpan data peserta (simulasi)
    setTimeout(() => {
        startQuiz();
        submitBtn.disabled = false;
        spinner.style.display = 'none';
    }, 800);
});

    function saveEnabledCategories() {
    localStorage.setItem('enabledCategories', JSON.stringify(enabledCategories));
}

function loadEnabledCategories() {
    const saved = localStorage.getItem('enabledCategories');
    if (saved) {
        enabledCategories = JSON.parse(saved);
    }
    updateCategoryUI();
}

// Panggil saat inisialisasi
document.addEventListener('DOMContentLoaded', function() {
    loadEnabledCategories();
    // ... kode lainnya
});
</script>
        
        <!-- Quiz Container -->
        <div id="quizContainer" class="quiz-container">
            <div class="quiz-header">
                <h1 class="quiz-title"><i class="fas fa-question-circle"></i> Quiz Pergunu</h1>
                <div class="quiz-info">
                    <div class="quiz-info-item" id="quizCategory">
                        <i class="fas fa-tag"></i> Kategori: <span id="categoryDisplay">Pelajar</span>
                    </div>
                    <div class="quiz-info-item" id="quizSubcategory">
                        <i class="fas fa-book"></i> Subkategori: <span id="subcategoryDisplay">IPA</span>
                    </div>
                    <div class="quiz-info-item" id="quizLevel">
                        <i class="fas fa-signal"></i> Level: <span id="levelDisplay">Mudah</span>
                    </div>
                    <div class="quiz-info-item" id="quizTimer">
                        <i class="fas fa-clock"></i> <span id="timeDisplay">90:00</span>
                    </div>
                </div>
            </div>
            
            <div class="question-container">
                <span class="question-number" id="questionNumber">Pertanyaan 1 dari 10</span>
                <p class="question-text" id="questionText">Memuat pertanyaan...</p>
            </div>
            
            <div class="options-container" id="optionsContainer">
                <!-- Options will be loaded here -->
            </div>
            
            <div class="explanation" id="explanation">
                <div class="explanation-title">
                    <i class="fas fa-lightbulb"></i> Penjelasan Jawaban:
                </div>
                <p class="explanation-text" id="explanationText">Memuat penjelasan...</p>
            </div>
            
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="resetBtn">
                    <i class="fas fa-redo"></i> Reset Quiz
                </button>
                <button class="btn btn-primary" id="nextBtn">
                    <i class="fas fa-arrow-right"></i> Selanjutnya
                </button>
            </div>
        </div>
        
        <!-- Results Container -->
        <div id="resultsContainer" class="results-container">
            <div class="certificate-wrapper">
                <div class="certificate-content">
                    <div class="certificate-watermark" id="watermarkCode">YUDHA CENDHANU/PELAJAR/IPA/10052025/URG9-46MC-AYNW/PERGUNU-STB</div>
                    
                    <div class="certificate-header">
                        <h2 class="certificate-title">SERTIFIKAT PRESTASI</h2>
                        <p class="certificate-subtitle">Diberikan Kepada</p>
                    </div>
                    
                    <div class="certificate-name" id="participantName">Nama Peserta</div>
                    
                    <div class="certificate-text">
                        Atas partisipasi dan pencapaian luar biasa dalam<br>
                        <strong>Ujian Pergunu Situbondo</strong>
                    </div>
                    
                    <div class="certificate-score" id="scoreDisplay">0%</div>
                    
                    <div class="certificate-text">
                        Sertifikat ini diberikan sebagai bentuk apresiasi atas dedikasi dan ketekunan dalam mengembangkan kemampuan berpikir logis serta pemahaman materi ujian. 
                        Semoga prestasi ini menjadi motivasi untuk terus belajar dan mengasah keterampilan demi masa depan yang lebih gemilang.
                    </div>
                    
                    <div class="certificate-message" id="resultsMessage">
                        <p>SEMPURNA! Anda sangat menguasai materi ini. Pertahankan prestasi ini!</p>
                    </div>
                    
                    <div class="certificate-footer">
                        <div class="certificate-date" id="certificateDate">Ditetapkan di: Situbondo, 09 Mei 2025</div>
                        <div class="barcode-container">
                            <img src="https://raw.githubusercontent.com/pergunu/quiz-pergunu/main/assets/images/BARCODE.png" alt="Barcode">
                            <div class="barcode-text">KETUA PERGUNU SITUBONDO</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Print Button -->
            <button class="print-certificate-btn" id="printBtn">
                <i class="fas fa-print"></i> Cetak Sertifikat
            </button>
            
            <button class="btn btn-primary" id="restartBtn" style="margin-top: 2rem;">
                <i class="fas fa-redo"></i> Ulangi Quiz
            </button>
        </div>
    </main>
    
    <!-- Floating Buttons -->
    <div class="floating-buttons" id="floatingButtons">
        <button class="floating-btn music-btn" id="musicToggle">
            <i class="fas fa-music"></i>
            <span class="tooltip">Putar/Mute Musik Latar</span>
        </button>
        
        <button class="floating-btn call-center-btn" id="callCenterBtn">
            <i class="fab fa-whatsapp"></i>
            <span class="tooltip">Butuh bantuan? Hubungi kami via WhatsApp</span>
        </button>
        
        <a href="https://is.gd/pergunusitubondo" class="floating-btn pergunu-link-btn" target="_blank">
            <i class="fas fa-link"></i>
            <span class="tooltip">Kunjungi Website Pergunu</span>
        </a>
        
        <button class="floating-btn admin-btn" id="adminBtn">
            <i class="fas fa-cog"></i>
            <span class="tooltip">Panel Admin</span>
        </button>
    </div>
    
    <!-- Admin Overlay -->
    <div class="admin-overlay" id="adminOverlay"></div>
    
    <!-- Admin Login -->
    <div class="admin-panel" id="adminLogin">
        <div class="admin-header">
            <h2 class="admin-title"><i class="fas fa-lock"></i> Admin Login</h2>
            <button class="admin-close" id="adminClose">&times;</button>
        </div>
        
        <div class="form-group">
            <label for="adminPassword" class="form-label">Password Admin</label>
            <input type="password" id="adminPassword" class="form-control" placeholder="Masukkan password admin">
        </div>
        <button class="btn btn-primary" id="adminLoginBtn">
            <i class="fas fa-sign-in-alt"></i> Login
        </button>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h2 class="admin-title"><i class="fas fa-cog"></i> Panel Admin</h2>
            <button class="admin-close" id="adminPanelClose">&times;</button>
        </div>
        
        <div class="admin-content" id="adminContent">
            <div class="form-group">
                <label for="adminCategoryFilter" class="form-label">Filter Kategori</label>
                <select id="adminCategoryFilter" class="form-control">
                    <option value="">Semua Kategori</option>
                    <option value="pelajar">Pelajar</option>
                    <option value="umum">Umum</option>
                </select>
            </div>
            
            <!-- Category Toggle Section -->
            <div class="ai-prompt-section">
                <div class="ai-prompt-title">
                    <i class="fas fa-toggle-on"></i> Aktifkan/Nonaktifkan Kategori Ujian
                </div>
                
                <div class="form-group">
                    <label class="form-label">Kategori Utama</label>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-success" id="enablePelajarBtn">
                            <i class="fas fa-check"></i> Aktifkan Pelajar
                        </button>
                        <button class="btn btn-danger" id="disablePelajarBtn">
                            <i class="fas fa-times"></i> Nonaktifkan Pelajar
                        </button>
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                        <button class="btn btn-success" id="enableUmumBtn">
                            <i class="fas fa-check"></i> Aktifkan Umum
                        </button>
                        <button class="btn btn-danger" id="disableUmumBtn">
                            <i class="fas fa-times"></i> Nonaktifkan Umum
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Subkategori Pelajar</label>
                    <div class="subcategory-options" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));">
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="ipa">
                            <i class="fas fa-check"></i> IPA
                        </button>
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="ips">
                            <i class="fas fa-check"></i> IPS
                        </button>
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="matematika">
                            <i class="fas fa-check"></i> Matematika
                        </button>
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="agama">
                            <i class="fas fa-check"></i> Agama
                        </button>
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="ppkn">
                            <i class="fas fa-check"></i> PPKN
                        </button>
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="sejarah">
                            <i class="fas fa-check"></i> Sejarah
                        </button>
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="bahasa_indonesia">
                            <i class="fas fa-check"></i> Bahasa Indonesia
                        </button>
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="pelajar" data-subcategory="bahasa_inggris">
                            <i class="fas fa-check"></i> Bahasa Inggris
                        </button>
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-sm btn-danger" id="disableAllPelajarBtn">
                            <i class="fas fa-times"></i> Nonaktifkan Semua Subkategori Pelajar
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Subkategori Umum</label>
                    <div class="subcategory-options" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));">
                        <button class="btn btn-sm btn-success enable-subcategory" data-category="umum" data-subcategory="logika">
                            <i class="fas fa-check"></i> Logika
                        </button>
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-sm btn-danger" id="disableAllUmumBtn">
                            <i class="fas fa-times"></i> Nonaktifkan Semua Subkategori Umum
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="question-list" id="questionList">
                <!-- Questions will be loaded here -->
            </div>
            
            <h3 class="admin-title"><i class="fas fa-plus-circle"></i> Tambah Soal Baru</h3>
            
            <!-- AI Prompt Section -->
            <div class="ai-prompt-section">
                <div class="ai-prompt-title">
                    <i class="fas fa-robot"></i> Generator Soal AI
                </div>
                <p style="margin-bottom: 0.75rem; font-size: 0.95rem;">Masukkan topik untuk menghasilkan soal secara otomatis:</p>
                <input type="text" id="aiPromptInput" class="form-control" placeholder="Contoh: Soal matematika dasar tentang aljabar untuk pelajar SMP">
                <div class="ai-loading" id="aiLoading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> Membuat soal, harap tunggu...
                </div>
                <button class="btn btn-success" id="generateQuestionBtn" style="width: 100%; margin-top: 1rem;">
                    <i class="fas fa-magic"></i> Generate Soal dengan AI
                </button>
            </div>
            
            <form id="addQuestionForm">
                <div class="form-group">
                    <label for="newCategory" class="form-label">Kategori</label>
                    <select id="newCategory" class="form-control" required>
                        <option value="">Pilih Kategori</option>
                        <option value="pelajar">Pelajar</option>
                        <option value="umum">Umum</option>
                    </select>
                </div>
                
                <div class="form-group" id="newSubcategoryGroup" style="display: none;">
                    <label for="newSubcategory" class="form-label">Subkategori</label>
                    <select id="newSubcategory" class="form-control">
                        <option value="ipa">IPA</option>
                        <option value="ips">IPS</option>
                        <option value="matematika">Matematika</option>
                        <option value="agama">Agama</option>
                        <option value="ppkn">PPKN</option>
                        <option value="sejarah">Sejarah</option>
                        <option value="bahasa_indonesia">Bahasa Indonesia</option>
                        <option value="bahasa_inggris">Bahasa Inggris</option>
                    </select>
                </div>
                
                <div class="form-group" id="newUmumSubcategoryGroup" style="display: none;">
                    <label for="newUmumSubcategory" class="form-label">Jenis Ujian</label>
                    <select id="newUmumSubcategory" class="form-control">
                        <option value="logika">Ujian Logika</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="newLevel" class="form-label">Tingkat Kesulitan</label>
                    <select id="newLevel" class="form-control" required>
                        <option value="">Pilih Tingkat</option>
                        <option value="mudah">Mudah</option>
                        <option value="sedang">Sedang</option>
                        <option value="sulit">Sulit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="newQuestion" class="form-label">Pertanyaan</label>
                    <textarea id="newQuestion" class="form-control" rows="3" required placeholder="Masukkan pertanyaan"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Pilihan Jawaban</label>
                    <div class="options-grid">
                        <div class="option-input" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                            <span class="option-prefix">A.</span>
                            <input type="text" id="optionA" class="form-control" placeholder="Pilihan A" required>
                        </div>
                        <div class="option-input" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                            <span class="option-prefix">B.</span>
                            <input type="text" id="optionB" class="form-control" placeholder="Pilihan B" required>
                        </div>
                        <div class="option-input" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                            <span class="option-prefix">C.</span>
                            <input type="text" id="optionC" class="form-control" placeholder="Pilihan C" required>
                        </div>
                        <div class="option-input" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                            <span class="option-prefix">D.</span>
                            <input type="text" id="optionD" class="form-control" placeholder="Pilihan D" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="correctAnswer" class="form-label">Jawaban Benar</label>
                    <select id="correctAnswer" class="form-control" required>
                        <option value="">Pilih Jawaban Benar</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="newExplanation" class="form-label">Penjelasan Jawaban</label>
                    <textarea id="newExplanation" class="form-control" rows="3" required placeholder="Masukkan penjelasan jawaban"></textarea>
                </div>
                
                <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" id="cancelAddQuestion">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Simpan Soal
                    </button>
                </div>
            </form>
            
            <div class="password-form" style="margin-top: 3rem;">
                <h3 class="admin-title"><i class="fas fa-key"></i> Ganti Password</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword" class="form-label">Password Lama</label>
                        <input type="password" id="currentPassword" class="form-control" required placeholder="Masukkan password lama">
                    </div>
                    <div class="form-group">
                        <label for="newPassword" class="form-label">Password Baru</label>
                        <input type="password" id="newPassword" class="form-control" required placeholder="Masukkan password baru (minimal 8 karakter)">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Konfirmasi Password</label>
                        <input type="password" id="confirmPassword" class="form-control" required placeholder="Konfirmasi password baru">
                    </div>
                    <div class="form-actions" style="display: flex; justify-content: flex-end; margin-top: 1.5rem;">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sync-alt"></i> Ganti Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Audio Elements -->
    <audio id="openingSound" preload="auto">
        <source src="assets/audio/opening.mp3" type="audio/mpeg">
    </audio>
    <audio id="welcomeSound" preload="auto">
        <source src="assets/audio/welcome.mp3" type="audio/mpeg">
    </audio>
    <audio id="quizMusic" loop preload="auto">
        <source src="assets/audio/quiz-music.mp3" type="audio/mpeg">
    </audio>
    <audio id="adhanSound" preload="auto">
        <source src="assets/audio/adhan.mp3" type="audio/mpeg">
    </audio>
    <audio id="backgroundMusic" preload="auto">
        <source src="assets/audio/background.mp3" type="audio/mpeg">
    </audio>
    <audio id="applauseSound" preload="auto">
        <source src="assets/audio/applause.mp3" type="audio/mpeg">
    </audio>
    <audio id="correctSound" preload="auto">
        <source src="assets/audio/correct.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrongSound" preload="auto">
        <source src="assets/audio/wrong.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // Data Soal yang Diperluas
        let questions = {
            pelajar: {
                ipa: {
                    mudah: [
                        {
                            id: 1,
                            question: "Organ apa yang bertanggung jawab untuk memompa darah ke seluruh tubuh?",
                            options: ["Jantung", "Paru-paru", "Hati", "Ginjal"],
                            answer: 0,
                            explanation: "Jantung adalah organ yang bertugas memompa darah ke seluruh tubuh melalui sistem peredaran darah."
                        },
                        {
                            id: 2,
                            question: "Zat apa yang diperlukan tanaman untuk fotosintesis?",
                            options: ["Karbon dioksida", "Oksigen", "Nitrogen", "Hidrogen"],
                            answer: 0,
                            explanation: "Tanaman menggunakan karbon dioksida, water, dan cahaya matahari untuk menghasilkan glukosa dan oksigen melalui proses fotosintesis."
                        }
                    ],
                    sedang: [
                        {
                            id: 3,
                            question: "Apa nama proses perubahan wujud dari padat langsung ke gas?",
                            options: ["Sublimasi", "Kondensasi", "Evaporasi", "Deposisi"],
                            answer: 0,
                            explanation: "Sublimasi adalah proses perubahan wujud dari padat langsung ke gas tanpa melalui fase cair, contohnya pada kapur barus."
                        }
                    ],
                    sulit: [
                        {
                            id: 4,
                            question: "Berapa jumlah kromosom pada sel tubuh manusia normal?",
                            options: ["46", "23", "64", "32"],
                            answer: 0,
                            explanation: "Sel tubuh manusia normal (somatis) memiliki 46 kromosom atau 23 pasang kromosom."
                        }
                    ]
                },
                ips: {
                    mudah: [
                        {
                            id: 5,
                            question: "Apa ibukota provinsi Jawa Barat?",
                            options: ["Bandung", "Jakarta", "Surabaya", "Semarang"],
                            answer: 0,
                            explanation: "Ibukota provinsi Jawa Barat adalah Bandung."
                        }
                    ],
                    sedang: [],
                    sulit: []
                },
                matematika: {
                    mudah: [
                        {
                            id: 6,
                            question: "Berapakah hasil dari 7  8?",
                            options: ["56", "64", "42", "49"],
                            answer: 0,
                            explanation: "Hasil dari 7 dikali 8 adalah 56."
                        }
                    ],
                    sedang: [],
                    sulit: []
                },
                agama: {
                    mudah: [
                        {
                            id: 7,
                            question: "Berapa jumlah rakaat shalat Subuh?",
                            options: ["2", "3", "4", "1"],
                            answer: 0,
                            explanation: "Shalat Subuh terdiri dari 2 rakaat."
                        }
                    ],
                    sedang: [],
                    sulit: []
                },
                ppkn: {
                    mudah: [
                        {
                            id: 8,
                            question: "Siapa presiden pertama Indonesia?",
                            options: ["Soekarno", "Soeharto", "BJ Habibie", "Gus Dur"],
                            answer: 0,
                            explanation: "Presiden pertama Indonesia adalah Ir. Soekarno."
                        }
                    ],
                    sedang: [],
                    sulit: []
                },
                sejarah: {
                    mudah: [
                        {
                            id: 9,
                            question: "Kapan Indonesia merdeka?",
                            options: ["17 Agustus 1945", "27 Desember 1949", "1 Juni 1945", "28 Oktober 1928"],
                            answer: 0,
                            explanation: "Indonesia merdeka pada tanggal 17 Agustus 1945."
                        }
                    ],
                    sedang: [],
                    sulit: []
                },
                bahasa_indonesia: {
                    mudah: [
                        {
                            id: 10,
                            question: "Apa sinonim dari kata 'bahagia'?",
                            options: ["Senang", "Sedih", "Marah", "Kecewa"],
                            answer: 0,
                            explanation: "Sinonim dari bahagia adalah senang."
                        }
                    ],
                    sedang: [],
                    sulit: []
                },
                bahasa_inggris: {
                    mudah: [
                        {
                            id: 11,
                            question: "Apa bahasa Inggrisnya 'buku'?",
                            options: ["Book", "Pen", "Table", "Chair"],
                            answer: 0,
                            explanation: "Bahasa Inggris dari buku adalah book."
                        }
                    ],
                    sedang: [],
                    sulit: []
                }
            },
            umum: {
                logika: {
                    mudah: [
                        {
                            id: 12,
                            question: "Jika semua manusia adalah makhluk hidup, dan Budi adalah manusia, maka:",
                            options: ["Budi adalah makhluk hidup", "Budi bukan makhluk hidup", "Budi mungkin makhluk hidup", "Tidak bisa disimpulkan"],
                            answer: 0,
                            explanation: "Karena semua manusia adalah makhluk hidup dan Budi adalah manusia, maka Budi pasti makhluk hidup."
                        }
                    ],
                    sedang: [],
                    sulit: []
                }
            }
        };

        // Variabel Quiz
        let currentCategory = 'pelajar';
        let currentSubcategory = 'ipa';
        let currentLevel = 'mudah';
        let currentQuestionIndex = 0;
        let score = 0;
        let timer;
        let quizStartTime;

        let enabledCategories = {
    pelajar: true,
    umum: true,
    subcategories: {
        pelajar: {
            ipa: true,
            ips: true,
            matematika: true,
            agama: true,
            ppkn: true,
            sejarah: true,
            bahasa_indonesia: true,
            bahasa_inggris: true
        },
        umum: {
            logika: true
        }
    }
};
        // Ganti seluruh bagian admin dengan yang berikut
let adminAuthenticated = false;
const ADMIN_SESSION_TIMEOUT = 30 * 60 * 1000; // 30 menit
let adminSessionTimeout;

function toggleAdminPanel() {
    if (adminAuthenticated) {
        showAdminPanel();
    } else {
        showAdminLogin();
    }
}

function showAdminLogin() {
    document.getElementById('adminOverlay').style.display = 'block';
    document.getElementById('adminLogin').style.display = 'block';
    document.getElementById('adminPassword').focus();
}

function showAdminPanel() {
    document.getElementById('adminOverlay').style.display = 'block';
    document.getElementById('adminPanel').style.display = 'block';
    document.getElementById('adminContent').style.display = 'block';
    loadQuestionsForAdmin();
    
    // Reset session timeout
    resetAdminSessionTimeout();
}

function resetAdminSessionTimeout() {
    clearTimeout(adminSessionTimeout);
    adminSessionTimeout = setTimeout(() => {
        adminAuthenticated = false;
        closeAdminPanels();
        alert('Sesi admin telah berakhir karena tidak aktif');
    }, ADMIN_SESSION_TIMEOUT);
}

function adminLogin() {
    const password = document.getElementById('adminPassword').value;
    
    // Dalam implementasi nyata, ganti dengan request ke server
    // Ini hanya contoh - JANGAN simpan password di kode frontend!
    const validPassword = "65614222"; // Hapus di production, gunakan autentikasi server
    
    if (password === validPassword) {
        adminAuthenticated = true;
        document.getElementById('adminLogin').style.display = 'none';
        showAdminPanel();
    } else {
        alert('Password salah!');
        document.getElementById('adminPassword').value = '';
        document.getElementById('adminPassword').focus();
    }
}

// Update semua event listener admin
document.getElementById('adminBtn').addEventListener('click', toggleAdminPanel);
document.getElementById('adminOverlay').addEventListener('click', closeAdminPanels);
document.getElementById('adminClose').addEventListener('click', closeAdminPanels);
document.getElementById('adminPanelClose').addEventListener('click', closeAdminPanels);
document.getElementById('adminLoginBtn').addEventListener('click', adminLogin);

// Tambahkan event listener untuk reset timeout saat ada interaksi
document.getElementById('adminPanel').addEventListener('mousemove', resetAdminSessionTimeout);
document.getElementById('adminPanel').addEventListener('keypress', resetAdminSessionTimeout);

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            initAudio();
            initEventListeners();
            updateCategoryUI();
            
            // Set current date for certificate
            const now = new Date();
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            document.getElementById('certificateDate').textContent = `Ditetapkan di: Situbondo, ${now.toLocaleDateString('id-ID', options)}`;
            
            // Pastikan opening screen hidden dan main container hidden
            document.getElementById('openingScreen').style.display = 'none';
            document.querySelector('.main-container').style.display = 'none';
        });

        // Fungsi update tampilan kategori berdasarkan pengaturan
       function updateCategoryUI() {
    // Update kategori utama
    document.querySelectorAll('.category-tab').forEach(tab => {
        const category = tab.dataset.category;
        tab.classList.toggle('disabled', !enabledCategories[category]);
        tab.style.cursor = enabledCategories[category] ? 'pointer' : 'not-allowed';
    });

    // Update subkategori
    updateSubcategoryUI('pelajar');
    updateSubcategoryUI('umum');
}

function updateSubcategoryUI(category) {
    const container = document.getElementById(`${category}Subcategories`);
    if (!container) return;
    
    container.querySelectorAll('.subcategory-radio').forEach(radio => {
        const subcategory = radio.value;
        const isEnabled = enabledCategories.subcategories[category][subcategory];
        radio.disabled = !isEnabled;
        
        const label = radio.nextElementSibling;
        if (label) {
            label.classList.toggle('disabled', !isEnabled);
            label.style.cursor = isEnabled ? 'pointer' : 'not-allowed';
            label.style.opacity = isEnabled ? '1' : '0.6';
        }
    });
}

        // Fungsi initAudio dengan volume maksimal
        function initAudio() {
            const audioElements = document.querySelectorAll('audio');
            audioElements.forEach(audio => {
                audio.volume = 1.0; // Volume 100%
            });
            
            document.body.addEventListener('click', function enableAudio() {
                document.body.removeEventListener('click', enableAudio);
                if (musicEnabled) {
                    playOpeningSound();
                }
            }, { once: true });
        }

        // Fungsi putar opening sound dengan volume maksimal
        function playOpeningSound() {
            const openingSound = document.getElementById('openingSound');
            openingSound.volume = 1.0;
            openingSound.play().catch(error => {
                console.log("Autoplay prevented:", error);
            });
        }

        // Fungsi toggle musik latar dengan volume maksimal
        function toggleBackgroundMusic() {
            const backgroundMusic = document.getElementById('backgroundMusic');
            backgroundMusic.volume = 1.0; // Volume 100%
            
            if (musicEnabled) {
                backgroundMusic.pause();
                document.getElementById('musicToggle').innerHTML = '<i class="fas fa-music"></i><span class="tooltip">Nyalakan Musik Latar</span>';
            } else {
                backgroundMusic.play().catch(error => {
                    console.log("Autoplay prevented:", error);
                });
                document.getElementById('musicToggle').innerHTML = '<i class="fas fa-music"></i><span class="tooltip">Matikan Musik Latar</span>';
            }
            musicEnabled = !musicEnabled;
        }

        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starsCount = 100;
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Random position
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                // Random size
                const size = Math.random() * 3 + 1;
                
                // Random opacity and duration
                const opacity = Math.random() * 0.7 + 0.3;
                const duration = Math.random() * 5 + 3;
                
                // Random delay
                const delay = Math.random() * 5;
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.setProperty('--opacity', opacity);
                star.style.setProperty('--duration', `${duration}s`);
                star.style.animationDelay = `${delay}s`;
                
                starsContainer.appendChild(star);
            }
        }

        function playWelcomeSound() {
            const welcomeSound = document.getElementById('welcomeSound');
            
            try {
                const promise = welcomeSound.play();
                if (promise !== undefined) {
                    promise.catch(error => {
                        console.log("Autoplay prevented:", error);
                    });
                }
            } catch (error) {
                console.log("Error playing welcome sound:", error);
            }
        }

        function playQuizMusic() {
            // Hanya mainkan jika quiz sedang berlangsung
            if (document.getElementById('quizContainer').style.display !== 'block') return;
            if (!quizMusicEnabled) return;
            
            const quizMusic = document.getElementById('quizMusic');
            
            try {
                const promise = quizMusic.play();
                if (promise !== undefined) {
                    promise.catch(error => {
                        console.log("Autoplay prevented:", error);
                    });
                }
                
                // Set waktu sholat (contoh: setiap 2 jam untuk demo)
                // Dalam implementasi nyata, gunakan waktu sholat sebenarnya
                clearTimeout(adhanTimeout);
                adhanTimeout = setTimeout(playAdhan, 2 * 60 * 60 * 1000); // 2 jam untuk demo
            } catch (error) {
                console.log("Error playing quiz music:", error);
            }
        }

        function playAdhan() {
            const quizMusic = document.getElementById('quizMusic');
            quizMusic.pause();
            
            const adhanSound = document.getElementById('adhanSound');
            
            try {
                const promise = adhanSound.play();
                if (promise !== undefined) {
                    promise.catch(error => {
                        console.log("Autoplay prevented:", error);
                    });
                }
                
                // Setelah adhan selesai, lanjutkan musik quiz
                adhanSound.onended = function() {
                    if (document.getElementById('quizContainer').style.display === 'block') {
                        playQuizMusic();
                    }
                };
            } catch (error) {
                console.log("Error playing adhan:", error);
                if (document.getElementById('quizContainer').style.display === 'block') {
                    playQuizMusic();
                }
            }
        }

        function initEventListeners() {
    // Login event - TAMBAHKAN KODE INI DI SINI
   // ####################### PASTE BARU MULAI DI SINI #######################
// Terms checkbox validation
document.getElementById('agreeTerms').addEventListener('change', function() {
    const continueBtn = document.getElementById('continueBtn');
    continueBtn.disabled = !this.checked;
    
    // Update button styling based on state
    if (this.checked) {
        continueBtn.style.opacity = '1';
        continueBtn.style.pointerEvents = 'auto';
        continueBtn.style.cursor = 'pointer';
    } else {
        continueBtn.style.opacity = '0.5';
        continueBtn.style.pointerEvents = 'none';
        continueBtn.style.cursor = 'not-allowed';
    }
});
// Continue button functionality
document.getElementById('continueBtn').addEventListener('click', function() {
    const btn = this;
    const btnText = document.getElementById('continueBtnText');
    const originalText = btnText.textContent;
    const spinner = btn.querySelector('.spinner');
    
    // Validate terms
    if (!document.getElementById('agreeTerms').checked) {
        showValidationError('Anda harus menyetujui syarat dan ketentuan terlebih dahulu');
        return;
    }
    
    // Show loading state
    btn.disabled = true;
    btnText.textContent = 'Memproses...';
    spinner.style.display = 'block';
    
    // Simulate loading (replace with actual async operation if needed)
    setTimeout(() => {
        // Hide opening screen and show main content
        document.getElementById('openingScreen').style.display = 'none';
        document.querySelector('.main-container').style.display = 'flex';
        document.getElementById('participantForm').style.display = 'block';
        
        // Play welcome sound
        try {
            document.getElementById('welcomeSound').play();
        } catch (e) {
            console.log("Autoplay blocked:", e);
        }
        
        // Scroll to top
        window.scrollTo(0, 0);
        
        // Reset button state (in case user goes back)
        btn.disabled = false;
        btnText.textContent = originalText;
        spinner.style.display = 'none';
    }, 800);
});

// Helper function to show validation errors
function showValidationError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'validation-error';
    errorDiv.innerHTML = `
        <i class="fas fa-exclamation-circle"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(errorDiv);
    
    // Remove after 5 seconds
    setTimeout(() => {
        errorDiv.style.opacity = '0';
        setTimeout(() => errorDiv.remove(), 300);
    }, 5000);
}
// ####################### PASTE BARU SELESAI DI SINI #######################

            // Pilih kategori utama
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    
                    document.querySelector('.category-tab.active').classList.remove('active');
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    
                    // Tampilkan subkategori yang sesuai
                    if (currentCategory === 'pelajar') {
                        document.getElementById('pelajarSubcategories').style.display = 'block';
                        document.getElementById('umumSubcategories').style.display = 'none';
                        document.getElementById('profesiField').style.display = 'none';
                        document.querySelector('input[name="subcategory"][value="ipa"]').checked = true;
                        currentSubcategory = 'ipa';
                    } else {
                        document.getElementById('pelajarSubcategories').style.display = 'none';
                        document.getElementById('umumSubcategories').style.display = 'block';
                        document.getElementById('profesiField').style.display = 'block';
                        document.querySelector('input[name="subcategory"][value="logika"]').checked = true;
                        currentSubcategory = 'logika';
                    }
                });
            });
            
            // Pilih subkategori
            document.querySelectorAll('input[name="subcategory"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        currentSubcategory = this.value;
                    }
                });
            });

            // Mulai quiz
            document.getElementById('participantForm').addEventListener('submit', function(e) {
                e.preventDefault();
                startQuiz();
            });

            // Admin toggle
            document.getElementById('adminBtn').addEventListener('click', toggleAdminPanel);
            document.getElementById('adminOverlay').addEventListener('click', closeAdminPanels);
            document.getElementById('adminClose').addEventListener('click', closeAdminPanels);
            document.getElementById('adminPanelClose').addEventListener('click', closeAdminPanels);

            // Admin login
            document.getElementById('adminLoginBtn').addEventListener('click', adminLogin);

            // Navigation buttons
            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
            document.getElementById('resetBtn').addEventListener('click', resetQuiz);
            document.getElementById('restartBtn').addEventListener('click', resetQuiz);

            // Admin functions
            document.getElementById('adminCategoryFilter').addEventListener('change', filterQuestions);
            document.getElementById('addQuestionForm').addEventListener('submit', addQuestion);
            document.getElementById('cancelAddQuestion').addEventListener('click', function() {
                document.getElementById('addQuestionForm').reset();
            });
            document.getElementById('changePasswordForm').addEventListener('submit', changePassword);
            
            // Admin form category change
            document.getElementById('newCategory').addEventListener('change', function() {
                const category = this.value;
                document.getElementById('newSubcategoryGroup').style.display = category === 'pelajar' ? 'block' : 'none';
                document.getElementById('newUmumSubcategoryGroup').style.display = category === 'umum' ? 'block' : 'none';
            });
            
            // AI Question Generator
            document.getElementById('generateQuestionBtn').addEventListener('click', generateQuestionWithAI);
            
            // Action buttons
            document.getElementById('printBtn').addEventListener('click', printResults);
            
            // Music controls
            document.getElementById('musicToggle').addEventListener('click', toggleBackgroundMusic);
            document.getElementById('callCenterBtn').addEventListener('click', function() {
                window.open('https://wa.me/6285647709114', '_blank');
            });

            // Category toggle buttons
            document.getElementById('enablePelajarBtn').addEventListener('click', function() {
                enabledCategories.pelajar = true;
                updateCategoryUI();
                alert('Kategori Pelajar telah diaktifkan');
            });

            document.getElementById('disablePelajarBtn').addEventListener('click', function() {
                enabledCategories.pelajar = false;
                updateCategoryUI();
                alert('Kategori Pelajar telah dinonaktifkan');
            });

            document.getElementById('enableUmumBtn').addEventListener('click', function() {
                enabledCategories.umum = true;
                updateCategoryUI();
                alert('Kategori Umum telah diaktifkan');
            });

            document.getElementById('disableUmumBtn').addEventListener('click', function() {
                enabledCategories.umum = false;
                updateCategoryUI();
                alert('Kategori Umum telah dinonaktifkan');
            });

            // Subcategory toggle buttons
            document.querySelectorAll('.enable-subcategory').forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.dataset.category;
                    const subcategory = this.dataset.subcategory;
                    const isEnabled = enabledCategories.subcategories[category][subcategory];
                    
                    if (isEnabled) {
                        if (confirm(`Apakah Anda yakin ingin menonaktifkan subkategori ${subcategory}?`)) {
                            enabledCategories.subcategories[category][subcategory] = false;
                            updateCategoryUI();
                            alert(`Subkategori ${subcategory} telah dinonaktifkan`);
                        }
                    } else {
                        enabledCategories.subcategories[category][subcategory] = true;
                        updateCategoryUI();
                        alert(`Subkategori ${subcategory} telah diaktifkan`);
                    }
                });
            });

            document.getElementById('disableAllPelajarBtn').addEventListener('click', function() {
                if (confirm('Apakah Anda yakin ingin menonaktifkan semua subkategori Pelajar?')) {
                    Object.keys(enabledCategories.subcategories.pelajar).forEach(subcategory => {
                        enabledCategories.subcategories.pelajar[subcategory] = false;
                    });
                    updateCategoryUI();
                    alert('Semua subkategori Pelajar telah dinonaktifkan');
                }
            });

            document.getElementById('disableAllUmumBtn').addEventListener('click', function() {
                if (confirm('Apakah Anda yakin ingin menonaktifkan semua subkategori Umum?')) {
                    Object.keys(enabledCategories.subcategories.umum).forEach(subcategory => {
                        enabledCategories.subcategories.umum[subcategory] = false;
                    });
                    updateCategoryUI();
                    alert('Semua subkategori Umum telah dinonaktifkan');
                }
            });
        }

        function playSound(soundId) {
            if (!soundEffectsEnabled) return;
            
            const sound = document.getElementById(soundId);
            
            try {
                const promise = sound.play();
                if (promise !== undefined) {
                    promise.catch(error => {
                        console.log("Autoplay prevented:", error);
                    });
                }
            } catch (error) {
                console.log("Error playing sound:", error);
            }
        }

        // Tambahkan fungsi validasi sebelum memulai quiz
// Ganti seluruh fungsi startQuiz dengan yang berikut
function startQuiz() {
    // Validasi ketersediaan quiz
    const selectedCategory = document.querySelector('.category-tab.active').dataset.category;
    const selectedSubcategory = document.querySelector('input[name="subcategory"]:checked').value;
    const selectedLevel = document.getElementById('level').value;
    
    // Validasi kategori aktif
    if (!enabledCategories[selectedCategory]) {
        showValidationError('Kategori ini sedang tidak tersedia');
        return;
    }
    
    // Validasi subkategori aktif
    if (!enabledCategories.subcategories[selectedCategory] || 
        !enabledCategories.subcategories[selectedCategory][selectedSubcategory]) {
        showValidationError('Subkategori ini sedang tidak tersedia');
        return;
    }
    
    // Validasi ketersediaan soal
    if (!questions[selectedCategory] || 
        !questions[selectedCategory][selectedSubcategory] || 
        !questions[selectedCategory][selectedSubcategory][selectedLevel] || 
        questions[selectedCategory][selectedSubcategory][selectedLevel].length === 0) {
        showValidationError('Belum ada soal untuk kombinasi kategori, subkategori, dan level ini');
        return;
    }
    
    // Set current quiz parameters
    currentCategory = selectedCategory;
    currentSubcategory = selectedSubcategory;
    currentLevel = selectedLevel;
    
    // Update UI
    document.getElementById('participantName').textContent = formatName(document.getElementById('name').value);
    document.getElementById('categoryDisplay').textContent = currentCategory === 'pelajar' ? 'Pelajar' : 'Umum';
    
    // Map subcategory to display text
    const subcategoryMap = {
        pelajar: {
            'ipa': 'IPA',
            'ips': 'IPS',
            'matematika': 'Matematika',
            'agama': 'Agama',
            'ppkn': 'PPKN',
            'sejarah': 'Sejarah',
            'bahasa_indonesia': 'Bahasa Indonesia',
            'bahasa_inggris': 'Bahasa Inggris'
        },
        umum: {
            'logika': 'Logika'
        }
    };
    
    document.getElementById('subcategoryDisplay').textContent = subcategoryMap[currentCategory][currentSubcategory];
    document.getElementById('levelDisplay').textContent = currentLevel.charAt(0).toUpperCase() + currentLevel.slice(1);
    
    // Hide form and show quiz
    document.getElementById('participantForm').style.display = 'none';
    document.getElementById('quizContainer').style.display = 'block';
    document.getElementById('resultsContainer').style.display = 'none';
    
    // Reset quiz variables
    currentQuestionIndex = 0;
    score = 0;
    quizStartTime = new Date();
    
    // Start timer (90 minutes)
    startTimer(90);
    
    // Load first question
    loadQuestion();
}

// Tambahkan fungsi helper ini
function showValidationError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'validation-error';
    errorDiv.innerHTML = `
        <i class="fas fa-exclamation-circle"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(errorDiv);
    
    // Hilangkan setelah 5 detik
    setTimeout(() => {
        errorDiv.style.opacity = '0';
        setTimeout(() => errorDiv.remove(), 300);
    }, 5000);
}

// Helper functions
function getParticipantData() {
    return {
        name: document.getElementById('name').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
        profesi: currentCategory === 'umum' 
               ? document.getElementById('profesi').value.trim() 
               : ''
    };
}

function validateParticipantData(data) {
    if (!data.name || !data.phone) {
        showValidationError('Nama lengkap dan nomor HP wajib diisi');
        return false;
    }
    
    if (!/^[0-9]{10,13}$/.test(data.phone)) {
        showValidationError('Nomor HP harus 10-13 digit angka');
        return false;
    }
    
    if (data.email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
        showValidationError('Format email tidak valid');
        return false;
    }
    
    return true;
}

function getQuizSelection() {
    const categoryEl = document.querySelector('.category-tab.active');
    const subcategoryEl = document.querySelector('input[name="subcategory"]:checked');
    
    if (!categoryEl || !subcategoryEl) {
        showValidationError('Silakan pilih kategori dan subkategori');
        return { valid: false };
    }

    const selection = {
        category: categoryEl.dataset.category,
        subcategory: subcategoryEl.value,
        level: document.getElementById('level').value,
        valid: true
    };

    if (!validateQuizAvailability(selection.category, selection.subcategory, selection.level)) {
        return { valid: false };
    }

    return selection;
}
    
    // Update UI dan mulai quiz
    updateQuizUI(name);
    initializeQuiz();
}

// Fungsi validasi terpisah yang lebih robust
function validateQuizAvailability(category, subcategory, level) {
    // Cek apakah kategori di-disable
    if (!enabledCategories[category]) {
        alert('Kategori ini sedang tidak tersedia!');
        return false;
    }
    
    // Cek apakah subkategori di-disable
    if (!enabledCategories.subcategories[category] || 
        !enabledCategories.subcategories[category][subcategory]) {
        alert('Subkategori ini sedang tidak tersedia!');
        return false;
    }
    
    // Periksa ketersediaan soal
    if (!questions[category] || !questions[category][subcategory] || 
        !questions[category][subcategory][level] || 
        questions[category][subcategory][level].length === 0) {
        alert('Belum ada soal untuk kategori, subkategori, dan level yang dipilih!');
        return false;
    }
    
    return true;
}
    
    // Update current category dan subcategory
    currentCategory = selectedCategory;
    currentSubcategory = selectedSubcategory;
    
    // Lanjutkan proses start quiz seperti sebelumnya...
    // ... (kode selanjutnya tetap sama)
}

// Perbaikan fungsi update UI untuk disable/enable
function updateCategoryUI() {
    // Update kategori utama
    document.querySelectorAll('.category-tab').forEach(tab => {
        const category = tab.dataset.category;
        tab.classList.toggle('disabled', !enabledCategories[category]);
        if (tab.classList.contains('disabled')) {
            tab.style.pointerEvents = 'none';
            tab.style.opacity = '0.5';
        } else {
            tab.style.pointerEvents = 'auto';
            tab.style.opacity = '1';
        }
    });

    // Update subkategori pelajar
  // Fungsi utama update UI kategori
function updateCategoryUI() {
    // Update kategori utama
    updateMainCategories();
    
    // Update subkategori
    updateSubcategoryUI('pelajar');
    updateSubcategoryUI('umum');
}

// Fungsi untuk update kategori utama
function updateMainCategories() {
    document.querySelectorAll('.category-tab').forEach(tab => {
        const category = tab.dataset.category;
        const isEnabled = enabledCategories[category];
        
        // Update class dan style
        tab.classList.toggle('disabled', !isEnabled);
        tab.style.cssText = `
            pointer-events: ${isEnabled ? 'auto' : 'none'};
            opacity: ${isEnabled ? '1' : '0.5'};
            cursor: ${isEnabled ? 'pointer' : 'not-allowed'};
        `;
        
        // Tambahkan tooltip jika dinonaktifkan
        if (!isEnabled) {
            tab.setAttribute('data-tooltip', 'Kategori dinonaktifkan oleh admin');
        } else {
            tab.removeAttribute('data-tooltip');
        }
    });
}

// Fungsi untuk update subkategori (reusable)
function updateSubcategoryUI(category) {
    const containerId = `${category}Subcategories`;
    const container = document.getElementById(containerId);
    
    if (!container) {
        console.warn(`Container #${containerId} tidak ditemukan`);
        return;
    }

    container.querySelectorAll('.subcategory-label').forEach(label => {
        const radio = label.previousElementSibling;
        if (!radio) return;

        const subcategory = radio.value;
        const isEnabled = enabledCategories.subcategories[category]?.[subcategory] ?? false;

        // Update elemen
        label.classList.toggle('disabled', !isEnabled);
        radio.disabled = !isEnabled;
        
        label.style.cssText = `
            pointer-events: ${isEnabled ? 'auto' : 'none'};
            opacity: ${isEnabled ? '1' : '0.5'};
            cursor: ${isEnabled ? 'pointer' : 'not-allowed'};
        `;
        
        // Tooltip
        if (!isEnabled) {
            label.setAttribute('data-tooltip', 'Subkategori dinonaktifkan oleh admin');
        } else {
            label.removeAttribute('data-tooltip');
        }
    });
}
            const email = document.getElementById('email').value;
            const profesi = currentCategory === 'umum' ? document.getElementById('profesi').value : '';
            currentLevel = document.getElementById('level').value;
            
            if (!name || !phone) {
                alert('Silakan isi nama lengkap dan nomor HP terlebih dahulu');
                return;
            }
            
            // Check if category is enabled
            if (!enabledCategories[currentCategory]) {
                alert('Kategori ini sedang tidak tersedia!');
                return;
            }
            
            // Check if subcategory is enabled
            if (!enabledCategories.subcategories[currentCategory][currentSubcategory]) {
                alert('Subkategori ini sedang tidak tersedia!');
                return;
            }
            
            // Check if there are questions for selected category/subcategory/level
            const availableQuestions = questions[currentCategory][currentSubcategory][currentLevel];
            if (!availableQuestions || availableQuestions.length === 0) {
                alert('Belum ada soal untuk kategori, subkategori, dan level yang dipilih!');
                return;
            }
            
            // Update participant name in certificate
            document.getElementById('participantName').textContent = formatName(name);
            
            // Update quiz info
            document.getElementById('categoryDisplay').textContent = currentCategory === 'pelajar' ? 'Pelajar' : 'Umum';
            
            // Set subcategory display text
            let subcategoryText = '';
            if (currentCategory === 'pelajar') {
                const subcategoryMap = {
                    'ipa': 'IPA',
                    'ips': 'IPS',
                    'matematika': 'Matematika',
                    'agama': 'Agama',
                    'ppkn': 'PPKN',
                    'sejarah': 'Sejarah',
                    'bahasa_indonesia': 'Bahasa Indonesia',
                    'bahasa_inggris': 'Bahasa Inggris'
                };
                subcategoryText = subcategoryMap[currentSubcategory];
            } else {
                const subcategoryMap = {
                    'logika': 'Logika'
                };
                subcategoryText = subcategoryMap[currentSubcategory];
            }
            document.getElementById('subcategoryDisplay').textContent = subcategoryText;
            
            document.getElementById('levelDisplay').textContent = 
                currentLevel.charAt(0).toUpperCase() + currentLevel.slice(1);
            
            // Hide form and show quiz
            document.getElementById('participantForm').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            // Reset variables
            currentQuestionIndex = 0;
            score = 0;
            quizStartTime = new Date();
            
            // Stop welcome and background music
            document.getElementById('welcomeSound').pause();
            document.getElementById('backgroundMusic').pause();
            
            // Start timer (90 minutes)
            startTimer(90);
            
            // Play quiz music
            playQuizMusic();
            
            // Load first question
            loadQuestion();
        }

        function formatName(name) {
            // Format nama dengan kapital di awal setiap kata
            return name.toLowerCase()
                .split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        function loadQuestion() {
            const question = questions[currentCategory][currentSubcategory][currentLevel][currentQuestionIndex];
            
            // Update question number
            document.getElementById('questionNumber').textContent = 
                `Pertanyaan ${currentQuestionIndex + 1} dari ${questions[currentCategory][currentSubcategory][currentLevel].length}`;
            
            // Set question text
            document.getElementById('questionText').textContent = question.question;
            
            // Clear and set options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.dataset.option = index;
                
                const prefix = document.createElement('span');
                prefix.className = 'option-prefix';
                prefix.textContent = String.fromCharCode(65 + index);
                
                const text = document.createElement('span');
                text.textContent = option;
                
                optionElement.appendChild(prefix);
                optionElement.appendChild(text);
                
                optionElement.addEventListener('click', function() {
                    selectAnswer(index);
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            // Hide explanation
            document.getElementById('explanation').style.display = 'none';
            
            // Update next button text if last question
            if (currentQuestionIndex === questions[currentCategory][currentSubcategory][currentLevel].length - 1) {
                document.getElementById('nextBtn').innerHTML = '<i class="fas fa-check"></i> Selesai';
            } else {
                document.getElementById('nextBtn').innerHTML = '<i class="fas fa-arrow-right"></i> Selanjutnya';
            }
        }

        function selectAnswer(selectedIndex) {
            const question = questions[currentCategory][currentSubcategory][currentLevel][currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            // Remove selected class from all options
            options.forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Add selected class to clicked option
            options[selectedIndex].classList.add('selected');
            
            // Check if answer is correct
            const isCorrect = selectedIndex === question.answer;
            
            // Store user answer
            question.userAnswer = selectedIndex;
            question.isCorrect = isCorrect;
            
            // Play sound effect
            if (isCorrect) {
                playSound('correctSound');
            } else {
                playSound('wrongSound');
            }
            
            // Show explanation
            document.getElementById('explanationText').textContent = question.explanation;
            document.getElementById('explanation').style.display = 'block';
            
            // Highlight correct and incorrect answers
            options[question.answer].classList.add('correct');
            if (!isCorrect) {
                options[selectedIndex].classList.add('incorrect');
            }
            
            // Disable all options after selection
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
        }

        function nextQuestion() {
            const question = questions[currentCategory][currentSubcategory][currentLevel][currentQuestionIndex];
            
            // Check if answer is selected
            if (typeof question.userAnswer === 'undefined') {
                alert('Silakan pilih jawaban terlebih dahulu');
                return;
            }
            
            // Increment score if correct
            if (question.isCorrect) {
                score++;
            }
            
            // Move to next question or finish quiz
            currentQuestionIndex++;
            if (currentQuestionIndex < questions[currentCategory][currentSubcategory][currentLevel].length) {
                loadQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            clearInterval(timer);
            clearTimeout(adhanTimeout);
            
            // Calculate results
            const totalQuestions = questions[currentCategory][currentSubcategory][currentLevel].length;
            const percentage = Math.round((score / totalQuestions) * 100);
            const endTime = new Date();
            const timeDiff = (endTime - quizStartTime) / 1000; // in seconds
            const minutes = Math.floor(timeDiff / 60);
            const seconds = Math.floor(timeDiff % 60);
            
            // Get participant data
            const name = document.getElementById('name').value;
            const categoryText = currentCategory === 'pelajar' ? 'PELAJAR' : 'UMUM';
            
            // Generate watermark code
            const now = new Date();
            const dateStr = `${now.getDate().toString().padStart(2, '0')}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getFullYear()}`;
            
            // Generate unique code (12 digit with dashes)
            const uniqueCode = generateUniqueCode();
            
            // Map subcategory to display text
            const subcategoryMap = {
                pelajar: {
                    'ipa': "IPA",
                    'ips': "IPS",
                    'matematika': "MATEMATIKA",
                    'agama': "AGAMA",
                    'ppkn': "PPKN",
                    'sejarah': "SEJARAH",
                    'bahasa_indonesia': "BAHASA INDONESIA",
                    'bahasa_inggris': "BAHASA INGGRIS"
                },
                umum: {
                    'logika': "UJIAN LOGIKA"
                }
            };
            
            // Dapatkan teks subkategori yang sesuai
            const subcategoryText = subcategoryMap[currentCategory][currentSubcategory];
            
            // Format watermark code baru
            const watermarkCode = `${name.toUpperCase()}/${categoryText}/${subcategoryText}/${dateStr}/${uniqueCode}/PERGUNU-STB`;
            
            // Display results
            document.getElementById('scoreDisplay').textContent = `${percentage}%`;
            document.getElementById('watermarkCode').textContent = watermarkCode;
            
            // Set result message
            let message = "";
            if (percentage >= 80) {
                message = `<p>SEMPURNA! Anda sangat luar biasa dalam menguasai materi ini. Pertahankan prestasi ini!</p>`;
                playSound('applauseSound');
                createConfetti();
            } else if (percentage >= 60) {
                message = `<p>BAIK SEKALI! Anda memiliki pemahaman yang solid tentang materi ini.</p>`;
                playSound('applauseSound');
                createConfetti();
            } else if (percentage >= 40) {
                message = `<p>CUKUP BAIK. Tingkatkan lagi belajarnya!</p>`;
            } else {
                message = `<p>TERUS BERLATIH! Setiap kesalahan adalah kesempatan untuk belajar lebih baik lagi.</p>`;
            }
            document.getElementById('resultsMessage').innerHTML = message;
            
            // Show results
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';
            
            // Hide floating buttons when in results page
            document.getElementById('floatingButtons').style.display = 'none';
            
            // Stop quiz music
            document.getElementById('quizMusic').pause();
        }

        function generateUniqueCode() {
            // Generate a 12-character code with dashes (format: XXXX-XXXX-XXXX)
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            
            for (let i = 0; i < 12; i++) {
                if (i > 0 && i % 4 === 0) {
                    code += '-';
                }
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return code;
        }

        function startTimer(minutes) {
            let timeLeft = minutes * 60; // Convert minutes to seconds
            
            // Update immediately
            updateTimerDisplay(timeLeft);
            
            // Start interval
            timer = setInterval(function() {
                timeLeft--;
                updateTimerDisplay(timeLeft);
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    finishQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay(timeLeft) {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timeDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is running out
            const timerElement = document.getElementById('quizTimer');
            if (timeLeft <= 60) {
                timerElement.style.background = '#fee2e2';
                timerElement.style.color = '#b91c1c';
                timerElement.style.borderColor = '#fca5a5';
            } else {
                timerElement.style.background = '';
                timerElement.style.color = '';
                timerElement.style.borderColor = '';
            }
        }

        function resetQuiz() {
            clearInterval(timer);
            clearTimeout(adhanTimeout);
            
            // Reset UI
            document.getElementById('participantForm').style.display = 'block';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
            
            // Show floating buttons again when leaving results page
            document.getElementById('floatingButtons').style.display = 'flex';
            
            // Reset form
            document.getElementById('participantForm').reset();
            document.querySelector('.category-tab[data-category="pelajar"]').classList.add('active');
            document.querySelectorAll('.category-tab[data-category="umum"]').forEach(tab => tab.classList.remove('active'));
            currentCategory = 'pelajar';
            
            // Show pelajar subcategories by default
            document.getElementById('pelajarSubcategories').style.display = 'block';
            document.getElementById('umumSubcategories').style.display = 'none';
            document.getElementById('profesiField').style.display = 'none';
            document.querySelector('input[name="subcategory"][value="ipa"]').checked = true;
            currentSubcategory = 'ipa';
            
            // Stop all audio
            document.getElementById('quizMusic').pause();
            document.getElementById('backgroundMusic').pause();
            
            // Remove confetti
            document.querySelectorAll('.confetti').forEach(el => el.remove());
        }

        function createConfetti() {
            const colors = ['#4361ee', '#3a0ca3', '#f72585', '#4cc9f0', '#4895ef', '#f8961e'];
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(confetti);
                
                // Remove after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        /* Admin Functions */
        function toggleAdminPanel() {
            document.getElementById('adminOverlay').style.display = 'block';
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminPassword').focus();
        }

        function closeAdminPanels() {
            document.getElementById('adminOverlay').style.display = 'none';
            document.getElementById('adminLogin').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === adminPassword) {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'block';
                loadQuestionsForAdmin();
            } else {
                alert('Password salah!');
            }
        }

        function loadQuestionsForAdmin() {
            const questionsList = document.getElementById('questionList');
            questionsList.innerHTML = '';
            
            // Loop through all questions
            for (const category in questions) {
                if (category === 'pelajar') {
                    for (const subcategory in questions[category]) {
                        for (const level in questions[category][subcategory]) {
                            questions[category][subcategory][level].forEach(question => {
                                addQuestionToAdminList(question, category, subcategory, level);
                            });
                        }
                    }
                } else {
                    for (const subcategory in questions[category]) {
                        for (const level in questions[category][subcategory]) {
                            questions[category][subcategory][level].forEach(question => {
                                addQuestionToAdminList(question, category, subcategory, level);
                            });
                        }
                    }
                }
            }
        }

        function addQuestionToAdminList(question, category, subcategory, level) {
            const questionsList = document.getElementById('questionList');
            
            const questionItem = document.createElement('div');
            questionItem.className = 'question-item';
            
            // Map subcategory to display text
            let subcategoryText = '';
            if (category === 'pelajar') {
                const subcategoryMap = {
                    'ipa': 'IPA',
                    'ips': 'IPS',
                    'matematika': 'Matematika',
                    'agama': 'Agama',
                    'ppkn': 'PPKN',
                    'sejarah': 'Sejarah',
                    'bahasa_indonesia': 'Bahasa Indonesia',
                    'bahasa_inggris': 'Bahasa Inggris'
                };
                subcategoryText = subcategoryMap[subcategory];
            } else {
                const subcategoryMap = {
                    'logika': 'Logika'
                };
                subcategoryText = subcategoryMap[subcategory];
            }
            
            questionItem.innerHTML = `
                <div class="question-meta">
                    <span><i class="fas fa-tag"></i> ${category === 'pelajar' ? 'Pelajar' : 'Umum'}</span>
                    <span><i class="fas fa-book"></i> ${subcategoryText}</span>
                    <span><i class="fas fa-signal"></i> ${level.charAt(0).toUpperCase() + level.slice(1)}</span>
                    <span><i class="fas fa-check-circle"></i> Jawaban: ${String.fromCharCode(65 + question.answer)}</span>
                </div>
                <div class="question-content">${question.question}</div>
                <div class="question-actions">
                    <button class="action-btn edit-question" data-id="${question.id}" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete-question" data-id="${question.id}" title="Hapus">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="edit-form" id="editForm-${question.id}"></div>
            `;
            
            questionsList.appendChild(questionItem);
            
            // Add event listeners
            questionItem.querySelector('.edit-question').addEventListener('click', function() {
                showEditForm(question, category, subcategory, level);
            });
            
            questionItem.querySelector('.delete-question').addEventListener('click', function() {
                if (confirm('Apakah Anda yakin ingin menghapus soal ini?')) {
                    deleteQuestion(question.id, category, subcategory, level);
                }
            });
        }

        function showEditForm(question, oldCategory, oldSubcategory, oldLevel) {
            const editForm = document.getElementById(`editForm-${question.id}`);
            
            if (editForm.style.display === 'block') {
                editForm.style.display = 'none';
                return;
            }
            
            // Hide all other edit forms
            document.querySelectorAll('.edit-form').forEach(form => {
                form.style.display = 'none';
            });
            
            editForm.innerHTML = `
                <div class="form-group">
                    <label>Kategori</label>
                    <select class="form-control edit-category">
                        <option value="pelajar" ${oldCategory === 'pelajar' ? 'selected' : ''}>Pelajar</option>
                        <option value="umum" ${oldCategory === 'umum' ? 'selected' : ''}>Umum</option>
                    </select>
                </div>
                
                ${oldCategory === 'pelajar' ? `
                <div class="form-group">
                    <label>Subkategori</label>
                    <select class="form-control edit-subcategory">
                        <option value="ipa" ${oldSubcategory === 'ipa' ? 'selected' : ''}>IPA</option>
                        <option value="ips" ${oldSubcategory === 'ips' ? 'selected' : ''}>IPS</option>
                        <option value="matematika" ${oldSubcategory === 'matematika' ? 'selected' : ''}>Matematika</option>
                        <option value="agama" ${oldSubcategory === 'agama' ? 'selected' : ''}>Agama</option>
                        <option value="ppkn" ${oldSubcategory === 'ppkn' ? 'selected' : ''}>PPKN</option>
                        <option value="sejarah" ${oldSubcategory === 'sejarah' ? 'selected' : ''}>Sejarah</option>
                        <option value="bahasa_indonesia" ${oldSubcategory === 'bahasa_indonesia' ? 'selected' : ''}>Bahasa Indonesia</option>
                        <option value="bahasa_inggris" ${oldSubcategory === 'bahasa_inggris' ? 'selected' : ''}>Bahasa Inggris</option>
                    </select>
                </div>
                ` : `
                <div class="form-group">
                    <label>Jenis Ujian</label>
                    <select class="form-control edit-subcategory">
                        <option value="logika" ${oldSubcategory === 'logika' ? 'selected' : ''}>Logika</option>
                    </select>
                </div>
                `}
                
                <div class="form-group">
                    <label>Tingkat</label>
                    <select class="form-control edit-level">
                        <option value="mudah" ${oldLevel === 'mudah' ? 'selected' : ''}>Mudah</option>
                        <option value="sedang" ${oldLevel === 'sedang' ? 'selected' : ''}>Sedang</option>
                        <option value="sulit" ${oldLevel === 'sulit' ? 'selected' : ''}>Sulit</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Pertanyaan</label>
                    <textarea class="form-control edit-question" rows="3">${question.question}</textarea>
                </div>
                <div class="form-group">
                    <label>Pilihan Jawaban</label>
                    ${question.options.map((option, index) => `
                    <div class="option-input" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                        <span class="option-prefix">${String.fromCharCode(65 + index)}.</span>
                        <input type="text" class="form-control edit-option" value="${option}" data-index="${index}">
                    </div>
                    `).join('')}
                </div>
                <div class="form-group">
                    <label>Jawaban Benar</label>
                    <select class="form-control edit-answer">
                        ${question.options.map((option, index) => `
                        <option value="${index}" ${question.answer === index ? 'selected' : ''}>
                            ${String.fromCharCode(65 + index)}
                        </option>
                        `).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Penjelasan</label>
                    <textarea class="form-control edit-explanation" rows="3">${question.explanation}</textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary cancel-edit">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="button" class="btn btn-primary save-edit">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                </div>
            `;
            
            editForm.style.display = 'block';
            
            // Add event listeners
            editForm.querySelector('.cancel-edit').addEventListener('click', function() {
                editForm.style.display = 'none';
            });
            
            editForm.querySelector('.save-edit').addEventListener('click', function() {
                saveQuestionChanges(question, oldCategory, oldSubcategory, oldLevel);
            });
        }

        function saveQuestionChanges(question, oldCategory, oldSubcategory, oldLevel) {
            const editForm = document.getElementById(`editForm-${question.id}`);
            
            // Get new values
            const newCategory = editForm.querySelector('.edit-category').value;
            const newSubcategory = editForm.querySelector('.edit-subcategory').value;
            const newLevel = editForm.querySelector('.edit-level').value;
            const newQuestionText = editForm.querySelector('.edit-question').value;
            const newOptions = Array.from(editForm.querySelectorAll('.edit-option')).map(input => input.value);
            const newAnswer = parseInt(editForm.querySelector('.edit-answer').value);
            const newExplanation = editForm.querySelector('.edit-explanation').value;
            
            // Validate
            if (!newQuestionText || newOptions.some(opt => !opt) || !newExplanation) {
                alert('Semua field harus diisi!');
                return;
            }
            
            // Update question
            question.question = newQuestionText;
            question.options = newOptions;
            question.answer = newAnswer;
            question.explanation = newExplanation;
            
            // If category or subcategory or level changed
            if (newCategory !== oldCategory || newSubcategory !== oldSubcategory || newLevel !== oldLevel) {
                // Remove from old location
                const oldQuestions = questions[oldCategory][oldSubcategory][oldLevel];
                const index = oldQuestions.findIndex(q => q.id === question.id);
                if (index !== -1) oldQuestions.splice(index, 1);
                
                // Add to new location
                if (!questions[newCategory][newSubcategory]) {
                    questions[newCategory][newSubcategory] = {
                        mudah: [],
                        sedang: [],
                        sulit: []
                    };
                }
                questions[newCategory][newSubcategory][newLevel].push(question);
            }
            
            // Reload questions list
            loadQuestionsForAdmin();
            editForm.style.display = 'none';
            
            alert('Perubahan berhasil disimpan!');
        }

        function deleteQuestion(id, category, subcategory, level) {
            const questionList = questions[category][subcategory][level];
            const index = questionList.findIndex(q => q.id === id);
            if (index !== -1) questionList.splice(index, 1);
            
            // Reload questions list
            loadQuestionsForAdmin();
            alert('Soal berhasil dihapus!');
        }

        function addQuestion(e) {
            e.preventDefault();
            
            // Get form values
            const category = document.getElementById('newCategory').value;
            const subcategory = category === 'pelajar' 
                ? document.getElementById('newSubcategory').value 
                : document.getElementById('newUmumSubcategory').value;
            const level = document.getElementById('newLevel').value;
            const questionText = document.getElementById('newQuestion').value;
            const options = [
                document.getElementById('optionA').value,
                document.getElementById('optionB').value,
                document.getElementById('optionC').value,
                document.getElementById('optionD').value
            ];
            const answer = document.getElementById('correctAnswer').value;
            const explanation = document.getElementById('newExplanation').value;
            
            // Validate
            if (!category || !level || !questionText || options.some(opt => !opt) || !answer || !explanation) {
                alert('Semua field harus diisi!');
                return;
            }
            
            // Create new question
            const newQuestion = {
                id: Date.now(), // Simple unique ID
                question: questionText,
                options: options,
                answer: answer.charCodeAt(0) - 65, // Convert A,B,C,D to 0,1,2,3
                explanation: explanation
            };
            
            // Initialize subcategory if not exists
            if (!questions[category][subcategory]) {
                questions[category][subcategory] = {
                    mudah: [],
                    sedang: [],
                    sulit: []
                };
            }
            
            // Add to questions
            questions[category][subcategory][level].push(newQuestion);
            
            // Reset form and reload list
            document.getElementById('addQuestionForm').reset();
            document.getElementById('newSubcategoryGroup').style.display = 'none';
            document.getElementById('newUmumSubcategoryGroup').style.display = 'none';
            loadQuestionsForAdmin();
            
            alert('Soal baru berhasil ditambahkan!');
        }

        function changePassword(e) {
            e.preventDefault();
            
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            // Validate
            if (currentPass !== adminPassword) {
                alert('Password lama salah!');
                return;
            }
            
            if (newPass !== confirmPass) {
                alert('Password baru dan konfirmasi tidak cocok!');
                return;
            }
            
            if (newPass.length < 8) {
                alert('Password baru harus minimal 8 karakter!');
                return;
            }
            
            // Change password
            adminPassword = newPass;
            document.getElementById('changePasswordForm').reset();
            
            alert('Password berhasil diubah!');
        }

        function filterQuestions() {
            const filter = document.getElementById('adminCategoryFilter').value;
            const questionsList = document.getElementById('questionList');
            
            // Show all if no filter
            if (!filter) {
                questionsList.querySelectorAll('.question-item').forEach(item => {
                    item.style.display = 'block';
                });
                return;
            }
            
            // Apply filter
            questionsList.querySelectorAll('.question-item').forEach(item => {
                const category = item.querySelector('.question-meta span:first-child').textContent.includes('Pelajar') ? 'pelajar' : 'umum';
                item.style.display = category === filter ? 'block' : 'none';
            });
        }

        /* AI Question Generator */
        async function generateQuestionWithAI() {
            const prompt = document.getElementById('aiPromptInput').value.trim();
            const category = document.getElementById('newCategory').value;
            const level = document.getElementById('newLevel').value;
            
            if (!prompt) {
                alert('Silakan masukkan prompt untuk menghasilkan soal!');
                return;
            }
            
            if (!category || !level) {
                alert('Silakan pilih kategori dan tingkat kesulitan terlebih dahulu!');
                return;
            }
            
            // Show loading
            document.getElementById('aiLoading').style.display = 'block';
            document.getElementById('generateQuestionBtn').disabled = true;
            
            try {
                // ####################################################
                // # UNCOMMENT DAN GUNAKAN INI UNTUK API ASLI        #
                // ####################################################
                /*
                const API_KEY = 'ISI API KEY DISINI'; // <-- INI TEMPAT API KEY
                const generatedQuestion = await callAIGenerateQuestion(prompt, category, level, API_KEY);
                */
                
                // Untuk sementara gunakan mock (hapus ketika sudah pakai API asli)
                const generatedQuestion = await mockAIGenerateQuestion(prompt, category, level);
                
                // Fill the form with generated question
                document.getElementById('newQuestion').value = generatedQuestion.question;
                document.getElementById('optionA').value = generatedQuestion.options[0];
                document.getElementById('optionB').value = generatedQuestion.options[1];
                document.getElementById('optionC').value = generatedQuestion.options[2];
                document.getElementById('optionD').value = generatedQuestion.options[3];
                document.getElementById('correctAnswer').value = generatedQuestion.correctAnswer;
                document.getElementById('newExplanation').value = generatedQuestion.explanation;
                
                alert('Soal berhasil digenerate! Silakan review dan simpan jika sudah sesuai.');
            } catch (error) {
                console.error('Error generating question:', error);
                alert('Gagal menghasilkan soal. Silakan coba lagi atau masukkan secara manual.');
            } finally {
                // Hide loading
                document.getElementById('aiLoading').style.display = 'none';
                document.getElementById('generateQuestionBtn').disabled = false;
            }
        }

        // Mock AI function - replace with your actual API call
        function mockAIGenerateQuestion(prompt, category, level) {
            return new Promise((resolve) => {
                // Simulate API delay
                setTimeout(() => {
                    // This is just a mock response - replace with actual API call
                    const mockResponses = [
                        {
                            question: `Apa yang dimaksud dengan ${prompt.split(' ').slice(0, 2).join(' ')}?`,
                            options: [
                                "Pilihan pertama yang benar",
                                "Pilihan kedua yang salah",
                                "Pilihan ketiga yang salah",
                                "Pilihan keempat yang salah"
                            ],
                            correctAnswer: "A",
                            explanation: `Penjelasan untuk jawaban yang benar tentang ${prompt.split(' ').slice(0, 2).join(' ')}.`
                        },
                        {
                            question: `Siapa penemu ${prompt.split(' ').slice(0, 2).join(' ')}?`,
                            options: [
                                "Nama penemu yang salah",
                                "Nama penemu yang benar",
                                "Nama penemu yang salah",
                                "Nama penemu yang salah"
                            ],
                            correctAnswer: "B",
                            explanation: `Penjelasan tentang penemu ${prompt.split(' ').slice(0, 2).join(' ')}.`
                        }
                    ];
                    
                    resolve(mockResponses[Math.floor(Math.random() * mockResponses.length)]);
                }, 2000);
            });
        }

        function printResults() {
            window.print();
        }
    </script>
</body>
</html>
