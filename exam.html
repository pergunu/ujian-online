<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilih Ujian - PERGUNU Situbondo</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="particles-js"></div>
    
    <div class="exam-selection-container">
        <div class="logo-container">
            <img src="assets/images/logo.png" alt="Logo PERGUNU Situbondo" class="logo">
        </div>
        
        <div class="exam-selection-content">
            <h2>Pilih Jenis Ujian</h2>
            
            <div class="participant-info">
                <p id="participant-name"></p>
                <p id="participant-status"></p>
            </div>
            
            <div class="exam-options">
                <!-- Pelajar Options -->
                <div id="student-options">
                    <h3>Tingkat Pelajar</h3>
                    
                    <div class="grade-level">
                        <h4>Pilih Kelas:</h4>
                        <div class="grade-buttons" id="sd-buttons">
                            <button class="grade-btn" data-grade="iv">Kelas IV</button>
                            <button class="grade-btn" data-grade="v">Kelas V</button>
                            <button class="grade-btn" data-grade="vi">Kelas VI</button>
                        </div>
                        
                        <div class="grade-buttons" id="smp-buttons" style="display: none;">
                            <button class="grade-btn" data-grade="vii">Kelas VII</button>
                            <button class="grade-btn" data-grade="viii">Kelas VIII</button>
                            <button class="grade-btn" data-grade="ix">Kelas IX</button>
                        </div>
                        
                        <div class="grade-buttons" id="sma-buttons" style="display: none;">
                            <button class="grade-btn" data-grade="x">Kelas X</button>
                            <button class="grade-btn" data-grade="xi">Kelas XI</button>
                            <button class="grade-btn" data-grade="xii">Kelas XII</button>
                        </div>
                    </div>
                    
                    <div class="subject-selection">
                        <h4>Pilih Mata Pelajaran:</h4>
                        <div class="subject-buttons">
                            <button class="subject-btn" data-subject="agama">AGAMA</button>
                            <button class="subject-btn" data-subject="ppkn">PPKN</button>
                            <button class="subject-btn" data-subject="sejarah">SEJARAH</button>
                            <button class="subject-btn" data-subject="ipa">IPA</button>
                            <button class="subject-btn" data-subject="ips">IPS</button>
                            <button class="subject-btn" data-subject="matematika">MATEMATIKA</button>
                            <button class="subject-btn" data-subject="bahasa-indonesia">BAHASA INDONESIA</button>
                            <button class="subject-btn" data-subject="bahasa-inggris">BAHASA INGGRIS</button>
                            <button class="subject-btn" data-subject="materi-extra">MATERI EXTRA</button>
                            <button class="subject-btn" data-subject="materi-khusus">MATERI KHUSUS</button>
                        </div>
                    </div>
                </div>
                
                <!-- Umum Options -->
                <div id="general-options" style="display: none;">
                    <h3>Tingkat Umum</h3>
                    
                    <div class="exam-type">
                        <h4>Pilih Jenis Ujian:</h4>
                        <div class="exam-buttons">
                            <button class="exam-btn" data-exam="tes-iq">Tes IQ</button>
                            <button class="exam-btn" data-exam="ujian-cpns">Ujian CPNS/P3K</button>
                        </div>
                    </div>
                    
                    <!-- CPNS License Code (hidden by default) -->
                    <div id="cpns-license" style="display: none;">
                        <div class="license-input">
                            <label for="license-code">Masukkan Kode Lisensi Ujian CPNS:</label>
                            <input type="password" id="license-code" placeholder="Kode Lisensi">
                            <button id="verify-license">Verifikasi</button>
                        </div>
                        <p class="license-info">Default: OPENLOCK-1945</p>
                    </div>
                </div>
                
                <div class="start-exam-btn">
                    <button id="start-exam" disabled>Mulai Ujian Sekarang</button>
                </div>
            </div>
            
            <div class="exam-info">
                <h4>Informasi Ujian:</h4>
                <ul>
                    <li>Waktu ujian: 120 menit</li>
                    <li>Jumlah soal: 50 butir</li>
                    <li>Sistem penilaian: +4 untuk jawaban benar, -1 untuk jawaban salah</li>
                    <li>Tidak bisa kembali ke soal sebelumnya</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="assets/js/particles.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize particles
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 },
                    move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "grab" },
                        onclick: { enable: true, mode: "push" },
                        resize: true
                    }
                },
                retina_detect: true
            });
            
            // Load participant data
            const participantData = JSON.parse(localStorage.getItem('participantData'));
            
            if(!participantData) {
                alert('Data peserta tidak ditemukan. Silakan daftar terlebih dahulu.');
                window.location.href = 'register.html';
                return;
            }
            
            // Display participant info
            document.getElementById('participant-name').textContent = `Nama: ${participantData.fullname}`;
            document.getElementById('participant-status').textContent = `Status: ${participantData.status === 'pelajar' ? 'Pelajar' : 'Umum'}`;
            
            // Show appropriate options based on participant status
            if(participantData.status === 'pelajar') {
                document.getElementById('student-options').style.display = 'block';
                document.getElementById('general-options').style.display = 'none';
                
                // Show appropriate grade buttons based on school level
                const schoolLevel = participantData.schoolLevel;
                if(schoolLevel === 'sd') {
                    document.getElementById('sd-buttons').style.display = 'flex';
                } else if(schoolLevel === 'smp') {
                    document.getElementById('smp-buttons').style.display = 'flex';
                } else if(schoolLevel === 'sma') {
                    document.getElementById('sma-buttons').style.display = 'flex';
                }
            } else {
                document.getElementById('student-options').style.display = 'none';
                document.getElementById('general-options').style.display = 'block';
            }
            
            // CPNS License verification
            const cpnsBtn = document.querySelector('.exam-btn[data-exam="ujian-cpns"]');
            const verifyLicenseBtn = document.getElementById('verify-license');
            const licenseCodeInput = document.getElementById('license-code');
            const startExamBtn = document.getElementById('start-exam');
            
            cpnsBtn?.addEventListener('click', function() {
                document.getElementById('cpns-license').style.display = 'block';
                startExamBtn.disabled = true;
            });
            
            verifyLicenseBtn?.addEventListener('click', function() {
                if(licenseCodeInput.value === 'OPENLOCK-1945') {
                    alert('Kode lisensi valid! Anda dapat melanjutkan ujian.');
                    startExamBtn.disabled = false;
                } else {
                    alert('Kode lisensi salah. Silakan coba lagi.');
                    licenseCodeInput.style.borderColor = 'red';
                }
            });
            
            // For other exam types, enable start button immediately
            document.querySelectorAll('.exam-btn:not([data-exam="ujian-cpns"]), .subject-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    startExamBtn.disabled = false;
                    if(document.getElementById('cpns-license')) {
                        document.getElementById('cpns-license').style.display = 'none';
                    }
                });
            });
            
            // Start exam
            startExamBtn.addEventListener('click', function() {
                // Save exam selection
                const examData = {
                    type: participantData.status === 'pelajar' ? 'pelajar' : 'umum',
                    subject: null,
                    grade: null,
                    examType: null,
                    timestamp: new Date().toISOString()
                };
                
                if(participantData.status === 'pelajar') {
                    const selectedGrade = document.querySelector('.grade-btn.active');
                    const selectedSubject = document.querySelector('.subject-btn.active');
                    
                    if(!selectedGrade || !selectedSubject) {
                        alert('Silakan pilih kelas dan mata pelajaran terlebih dahulu!');
                        return;
                    }
                    
                    examData.grade = selectedGrade.dataset.grade;
                    examData.subject = selectedSubject.dataset.subject;
                } else {
                    const selectedExam = document.querySelector('.exam-btn.active');
                    
                    if(!selectedExam) {
                        alert('Silakan pilih jenis ujian terlebih dahulu!');
                        return;
                    }
                    
                    examData.examType = selectedExam.dataset.exam;
                    
                    if(examData.examType === 'ujian-cpns' && licenseCodeInput.value !== 'OPENLOCK-1945') {
                        alert('Silakan verifikasi kode lisensi terlebih dahulu!');
                        return;
                    }
                }
                
                localStorage.setItem('examData', JSON.stringify(examData));
                window.location.href = 'test.html';
            });
            
            // Add active class to clicked buttons
            document.querySelectorAll('.grade-btn, .subject-btn, .exam-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from siblings
                    const siblings = this.parentElement.querySelectorAll('.grade-btn, .subject-btn, .exam-btn');
                    siblings.forEach(sib => sib.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                });
            });
        });
    </script>
</body>
</html>
