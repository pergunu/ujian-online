<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilihan Ujian - PERGUNU SITUBONDO</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <div id="particles-js"></div>
    <div class="container">
        <div class="exam-selection-box slide-in">
            <h1>Pilih Jenis Ujian</h1>
            
            <div id="exam-options">
                <!-- Options will be populated by JavaScript based on participant data -->
            </div>
            
            <div class="info-box">
                <h3>Informasi Berkala</h3>
                <p id="periodic-info">Sistem ujian online ini dikembangkan oleh Tim Kreator PERGUNU SITUBONDO untuk memudahkan proses evaluasi belajar.</p>
            </div>
        </div>
    </div>
    
    <!-- Floating Buttons -->
    <div class="floating-buttons">
        <button class="floating-btn share-btn" title="Bagikan">
            <i class="fas fa-share-alt"></i>
        </button>
        <button class="floating-btn whatsapp-btn" title="Chat Admin">
            <i class="fab fa-whatsapp"></i>
        </button>
        <button class="floating-btn question-bank-btn" title="Bank Soal" style="display: none;">
            <i class="fas fa-book"></i>
        </button>
        <button class="floating-btn admin-btn" title="Admin Panel" style="display: none;">
            <i class="fas fa-cog"></i>
        </button>
    </div>
    
    <!-- Modal for CPNS License -->
    <div id="cpns-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Masukkan Kode Lisensi Ujian CPNS/P3K</h2>
            <input type="password" id="cpns-code" placeholder="Masukkan Kode Lisensi">
            <button id="verify-cpns" class="btn-gradient">Verifikasi</button>
        </div>
    </div>
    
    <script src="../assets/js/particles.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load participant data
            const participantData = JSON.parse(sessionStorage.getItem('participantData'));
            const examOptions = document.getElementById('exam-options');
            
            // Load periodic info from localStorage or use default
            const periodicInfo = localStorage.getItem('periodicInfo') || 'Sistem ujian online ini dikembangkan oleh Tim Kreator PERGUNU SITUBONDO untuk memudahkan proses evaluasi belajar.';
            document.getElementById('periodic-info').textContent = periodicInfo;
            
            // Show different options based on participant status
            if (participantData.status === 'pelajar') {
                examOptions.innerHTML = `
                    <h2>Tingkat ${participantData.level.toUpperCase()}</h2>
                    <div class="grade-buttons">
                        ${getGradeButtons(participantData.level)}
                    </div>
                    
                    <h2>Pilih Mata Ujian</h2>
                    <div class="subject-buttons">
                        <button class="btn-subject" data-subject="agama">AGAMA</button>
                        <button class="btn-subject" data-subject="ppkn">PPKN</button>
                        <button class="btn-subject" data-subject="sejarah">SEJARAH</button>
                        <button class="btn-subject" data-subject="ipa">IPA</button>
                        <button class="btn-subject" data-subject="ips">IPS</button>
                        <button class="btn-subject" data-subject="matematika">MATEMATIKA</button>
                        <button class="btn-subject" data-subject="bahasa-indonesia">BAHASA INDONESIA</button>
                        <button class="btn-subject" data-subject="bahasa-inggris">BAHASA INGGRIS</button>
                        <button class="btn-subject" data-subject="materi-extra">MATERI EXTRA</button>
                        <button class="btn-subject" data-subject="materi-khusus">MATERI KHUSUS</button>
                    </div>
                `;
            } else {
                examOptions.innerHTML = `
                    <h2>Ujian untuk Umum</h2>
                    <div class="general-buttons">
                        <button class="btn-general" data-exam="logika">Ujian Logika</button>
                        <button class="btn-general" data-exam="cpns">Ujian CPNS/P3K</button>
                    </div>
                `;
            }
            
            // Handle subject buttons for students
            document.querySelectorAll('.btn-subject').forEach(btn => {
                btn.addEventListener('click', function() {
                    const subject = this.getAttribute('data-subject');
                    const grade = document.querySelector('.grade-btn.active')?.getAttribute('data-grade');
                    
                    if (!grade) {
                        alert('Silakan pilih kelas terlebih dahulu');
                        return;
                    }
                    
                    // Save exam selection
                    sessionStorage.setItem('examSelection', JSON.stringify({
                        type: 'pelajar',
                        level: participantData.level,
                        grade,
                        subject
                    }));
                    
                    // Redirect to exam
                    window.location.href = 'exam.html';
                });
            });
            
            // Handle general exam buttons
            document.querySelectorAll('.btn-general').forEach(btn => {
                btn.addEventListener('click', function() {
                    const examType = this.getAttribute('data-exam');
                    
                    if (examType === 'cpns') {
                        // Show CPNS license modal
                        document.getElementById('cpns-modal').style.display = 'block';
                    } else {
                        // Save exam selection
                        sessionStorage.setItem('examSelection', JSON.stringify({
                            type: 'umum',
                            exam: examType
                        }));
                        
                        // Redirect to exam
                        window.location.href = 'exam.html';
                    }
                });
            });
            
            // CPNS modal functionality
            const cpnsModal = document.getElementById('cpns-modal');
            const closeModal = document.querySelector('.close-modal');
            const verifyCpnsBtn = document.getElementById('verify-cpns');
            
            closeModal.addEventListener('click', function() {
                cpnsModal.style.display = 'none';
            });
            
            verifyCpnsBtn.addEventListener('click', function() {
                const cpnsCode = document.getElementById('cpns-code').value;
                
                // Default CPNS code: OPENLOCK-1945
                if (cpnsCode === 'OPENLOCK-1945') {
                    // Save exam selection
                    sessionStorage.setItem('examSelection', JSON.stringify({
                        type: 'umum',
                        exam: 'cpns'
                    }));
                    
                    // Redirect to exam
                    window.location.href = 'exam.html';
                } else {
                    alert('Kode lisensi salah. Silakan coba lagi.');
                }
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === cpnsModal) {
                    cpnsModal.style.display = 'none';
                }
            });
            
            // Admin buttons (hidden by default, shown if admin code is entered)
            if (sessionStorage.getItem('isAdmin')) {
                document.querySelector('.question-bank-btn').style.display = 'flex';
                document.querySelector('.admin-btn').style.display = 'flex';
                
                document.querySelector('.question-bank-btn').addEventListener('click', function() {
                    window.location.href = 'admin/questions.html';
                });
                
                document.querySelector('.admin-btn').addEventListener('click', function() {
                    window.location.href = 'admin/index.html';
                });
            }
        });
        
        function getGradeButtons(level) {
            const grades = {
                'sd': ['IV', 'V', 'VI'],
                'smp': ['VII', 'VIII', 'IX'],
                'sma': ['X', 'XI', 'XII']
            };
            
            return grades[level].map(grade => `
                <button class="grade-btn" data-grade="${grade.toLowerCase()}">Kelas ${grade}</button>
            `).join('');
        }
    </script>
</body>
</html>
