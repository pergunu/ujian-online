<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Soal - Ujian Online PERGUNU</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <style>
        .question-management {
            display: flex;
            gap: 2rem;
        }
        
        .question-list {
            flex: 1;
        }
        
        .question-form {
            width: 400px;
        }
        
        .question-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .question-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .question-card h4 {
            margin-bottom: 0.5rem;
            color: #4e54c8;
        }
        
        .question-card .options {
            margin-left: 1.5rem;
        }
        
        .question-card .correct-answer {
            font-weight: 600;
            color: #4CAF50;
        }
        
        .question-card .explanation {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }
        
        .question-card .meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.8rem;
            color: #888;
        }
        
        .question-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-edit {
            background: #FFC107;
            color: white;
        }
        
        .btn-delete {
            background: #F44336;
            color: white;
        }
        
        .ai-prompt {
            margin-top: 1rem;
            padding: 1rem;
            background: #f5f7fa;
            border-radius: 8px;
        }
        
        .ai-prompt textarea {
            width: 100%;
            min-height: 100px;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: #4e54c8;
            color: #4e54c8;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-sidebar">
            <div class="admin-logo">
                <img src="../../assets/images/logo.png" alt="PERGUNU SITUBONDO">
            </div>
            
            <ul class="admin-menu">
                <li><a href="../index.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" class="active"><i class="fas fa-book"></i> Bank Soal</a></li>
                <li><a href="../participants.html"><i class="fas fa-users"></i> Peserta Ujian</a></li>
                <li><a href="#"><i class="fas fa-lock"></i> Pengaturan Kode</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> Pengaturan Ujian</a></li>
                <li><a href="#"><i class="fas fa-certificate"></i> Pengaturan Sertifikat</a></li>
                <li><a href="#"><i class="fas fa-edit"></i> Konten Website</a></li>
                <li><a href="../../index.html"><i class="fas fa-sign-out-alt"></i> Keluar</a></li>
            </ul>
        </div>
        
        <div class="admin-content">
            <div class="admin-header">
                <h1 class="admin-title">Bank Soal</h1>
                <div class="admin-actions">
                    <button class="btn-admin" id="refresh-questions"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-category="pelajar">Pelajar</div>
                <div class="tab" data-category="umum">Umum</div>
                <div class="tab" data-category="cpns">CPNS/P3K</div>
            </div>
            
            <div class="question-management">
                <div class="question-list">
                    <h3>Daftar Soal</h3>
                    <div id="questions-container">
                        <!-- Questions will be loaded here -->
                    </div>
                </div>
                
                <div class="question-form">
                    <h3>Tambah/Edit Soal</h3>
                    
                    <div class="admin-card">
                        <div class="form-group">
                            <label>Kategori Soal</label>
                            <select id="question-category">
                                <option value="pelajar">Pelajar</option>
                                <option value="umum">Umum</option>
                                <option value="cpns">CPNS/P3K</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Subjek Soal</label>
                            <select id="question-subject">
                                <option value="agama">AGAMA</option>
                                <option value="ppkn">PPKN</option>
                                <option value="sejarah">SEJARAH</option>
                                <option value="ipa">IPA</option>
                                <option value="ips">IPS</option>
                                <option value="matematika">MATEMATIKA</option>
                                <option value="bahasa-indonesia">BAHASA INDONESIA</option>
                                <option value="bahasa-inggris">BAHASA INGGRIS</option>
                                <option value="materi-extra">MATERI EXTRA</option>
                                <option value="materi-khusus">MATERI KHUSUS</option>
                                <option value="logika">Ujian Logika</option>
                                <option value="cpns">Ujian CPNS/P3K</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Tingkat/Kelas</label>
                            <select id="question-level">
                                <option value="sd">SD</option>
                                <option value="smp">SMP</option>
                                <option value="sma">SMA/SMK</option>
                                <option value="umum">Umum</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Pertanyaan</label>
                            <textarea id="question-text" placeholder="Masukkan pertanyaan"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Pilihan Jawaban</label>
                            <div class="options-container">
                                <div class="option-input">
                                    <input type="text" id="option-a" placeholder="Pilihan A">
                                </div>
                                <div class="option-input">
                                    <input type="text" id="option-b" placeholder="Pilihan B">
                                </div>
                                <div class="option-input">
                                    <input type="text" id="option-c" placeholder="Pilihan C">
                                </div>
                                <div class="option-input">
                                    <input type="text" id="option-d" placeholder="Pilihan D">
                                </div>
                                <div class="option-input">
                                    <input type="text" id="option-e" placeholder="Pilihan E">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Jawaban Benar</label>
                            <select id="correct-answer">
                                <option value="0">A</option>
                                <option value="1">B</option>
                                <option value="2">C</option>
                                <option value="3">D</option>
                                <option value="4">E</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Penjelasan Jawaban</label>
                            <textarea id="explanation" placeholder="Masukkan penjelasan jawaban"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Gambar (Opsional)</label>
                            <input type="file" id="question-image" accept="image/*">
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn-admin" id="save-question"><i class="fas fa-save"></i> Simpan Soal</button>
                            <button class="btn-admin btn-cancel" id="cancel-edit" style="display: none;"><i class="fas fa-times"></i> Batal</button>
                        </div>
                    </div>
                    
                    <div class="ai-prompt">
                        <h4>Generate Soal dengan AI</h4>
                        <textarea id="ai-prompt" placeholder="Masukkan prompt untuk menghasilkan soal (contoh: 'Buatkan 5 soal pilihan ganda tentang sejarah kemerdekaan Indonesia untuk tingkat SMP')"></textarea>
                        <button class="btn-admin" id="generate-questions"><i class="fas fa-magic"></i> Generate Soal</button>
                        <small>Anda perlu menambahkan API Key AI di bagian kode untuk fitur ini</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="../../assets/js/admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let currentQuestions = [];
            let editingQuestionId = null;
            
            // Load questions
            loadQuestions('pelajar');
            
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const category = this.getAttribute('data-category');
                    loadQuestions(category);
                });
            });
            
            // Category change
            document.getElementById('question-category').addEventListener('change', function() {
                const category = this.value;
                const subjectSelect = document.getElementById('question-subject');
                
                if (category === 'pelajar') {
                    subjectSelect.innerHTML = `
                        <option value="agama">AGAMA</option>
                        <option value="ppkn">PPKN</option>
                        <option value="sejarah">SEJARAH</option>
                        <option value="ipa">IPA</option>
                        <option value="ips">IPS</option>
                        <option value="matematika">MATEMATIKA</option>
                        <option value="bahasa-indonesia">BAHASA INDONESIA</option>
                        <option value="bahasa-inggris">BAHASA INGGRIS</option>
                        <option value="materi-extra">MATERI EXTRA</option>
                        <option value="materi-khusus">MATERI KHUSUS</option>
                    `;
                } else if (category === 'umum') {
                    subjectSelect.innerHTML = `
                        <option value="logika">Ujian Logika</option>
                    `;
                } else {
                    subjectSelect.innerHTML = `
                        <option value="cpns">Ujian CPNS/P3K</option>
                    `;
                }
            });
            
            // Save question
            document.getElementById('save-question').addEventListener('click', function() {
                const question = {
                    category: document.getElementById('question-category').value,
                    subject: document.getElementById('question-subject').value,
                    level: document.getElementById('question-level').value,
                    text: document.getElementById('question-text').value,
                    options: [
                        document.getElementById('option-a').value,
                        document.getElementById('option-b').value,
                        document.getElementById('option-c').value,
                        document.getElementById('option-d').value,
                        document.getElementById('option-e').value
                    ],
                    correctAnswer: parseInt(document.getElementById('correct-answer').value),
                    explanation: document.getElementById('explanation').value
                };
                
                // Validate
                if (!question.text || question.options.some(opt => !opt)) {
                    alert('Silakan lengkapi semua field');
                    return;
                }
                
                // Save to localStorage
                let questions = JSON.parse(localStorage.getItem('questions')) || [];
                
                if (editingQuestionId !== null) {
                    // Update existing question
                    questions = questions.map(q => q.id === editingQuestionId ? {...question, id: editingQuestionId} : q);
                } else {
                    // Add new question
                    question.id = Date.now().toString();
                    questions.push(question);
                }
                
                localStorage.setItem('questions', JSON.stringify(questions));
                
                // Reset form
                resetQuestionForm();
                
                // Reload questions
                loadQuestions(document.querySelector('.tab.active').getAttribute('data-category'));
                
                alert('Soal berhasil disimpan');
            });
            
            // Cancel edit
            document.getElementById('cancel-edit').addEventListener('click', function() {
                resetQuestionForm();
            });
            
            // Generate questions with AI
            document.getElementById('generate-questions').addEventListener('click', function() {
                const prompt = document.getElementById('ai-prompt').value;
                
                if (!prompt) {
                    alert('Silakan masukkan prompt untuk menghasilkan soal');
                    return;
                }
                
                alert('Fitur ini membutuhkan integrasi dengan API AI. Silakan tambahkan API Key yang sesuai di bagian kode.');
                
                // In a real implementation, you would call an AI API here
                // For example:
                /*
                const apiKey = 'YOUR_AI_API_KEY'; // This is where you would add your API key
                fetch('https://api.openai.com/v1/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'text-davinci-003',
                        prompt: `Generate multiple choice questions in JSON format based on: ${prompt}`,
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Process the generated questions
                    console.log(data);
                    // You would then parse the response and add the questions to your form
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Gagal menghasilkan soal. Silakan coba lagi.');
                });
                */
            });
            
            // Load questions function
            function loadQuestions(category) {
                const questions = JSON.parse(localStorage.getItem('questions')) || [];
                currentQuestions = questions.filter(q => q.category === category);
                
                const container = document.getElementById('questions-container');
                container.innerHTML = '';
                
                if (currentQuestions.length === 0) {
                    container.innerHTML = '<p>Tidak ada soal untuk kategori ini.</p>';
                    return;
                }
                
                currentQuestions.forEach(question => {
                    const questionCard = document.createElement('div');
                    questionCard.className = 'question-card';
                    questionCard.setAttribute('data-id', question.id);
                    
                    questionCard.innerHTML = `
                        <h4>${question.text}</h4>
                        <div class="options">
                            ${question.options.map((opt, i) => `
                                <div class="${i === question.correctAnswer ? 'correct-answer' : ''}">
                                    ${String.fromCharCode(65 + i)}. ${opt}
                                </div>
                            `).join('')}
                        </div>
                        <div class="explanation">${question.explanation}</div>
                        <div class="meta">
                            <span>${question.subject.toUpperCase()} - ${question.level.toUpperCase()}</span>
                            <span>${new Date(parseInt(question.id)).toLocaleDateString()}</span>
                        </div>
                        <div class="question-actions">
                            <button class="btn-small btn-edit" data-id="${question.id}"><i class="fas fa-edit"></i> Edit</button>
                            <button class="btn-small btn-delete" data-id="${question.id}"><i class="fas fa-trash"></i> Hapus</button>
                        </div>
                    `;
                    
                    container.appendChild(questionCard);
                });
                
                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.btn-edit').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const questionId = this.getAttribute('data-id');
                        editQuestion(questionId);
                    });
                });
                
                document.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const questionId = this.getAttribute('data-id');
                        deleteQuestion(questionId);
                    });
                });
                
                // Add event listener to question cards
                document.querySelectorAll('.question-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const questionId = this.getAttribute('data-id');
                        viewQuestion(questionId);
                    });
                });
            }
            
            // Edit question function
            function editQuestion(questionId) {
                const question = currentQuestions.find(q => q.id === questionId);
                if (!question) return;
                
                editingQuestionId = questionId;
                
                // Fill form
                document.getElementById('question-category').value = question.category;
                document.getElementById('question-subject').value = question.subject;
                document.getElementById('question-level').value = question.level;
                document.getElementById('question-text').value = question.text;
                document.getElementById('option-a').value = question.options[0];
                document.getElementById('option-b').value = question.options[1];
                document.getElementById('option-c').value = question.options[2];
                document.getElementById('option-d').value = question.options[3];
                document.getElementById('option-e').value = question.options[4];
                document.getElementById('correct-answer').value = question.correctAnswer;
                document.getElementById('explanation').value = question.explanation;
                
                // Show cancel button
                document.getElementById('cancel-edit').style.display = 'inline-block';
                
                // Scroll to form
                document.querySelector('.question-form').scrollIntoView({ behavior: 'smooth' });
            }
            
            // View question function
            function viewQuestion(questionId) {
                const question = currentQuestions.find(q => q.id === questionId);
                if (!question) return;
                
                alert(`Pertanyaan: ${question.text}\n\nJawaban benar: ${String.fromCharCode(65 + question.correctAnswer)}`);
            }
            
            // Delete question function
            function deleteQuestion(questionId) {
                if (!confirm('Apakah Anda yakin ingin menghapus soal ini?')) return;
                
                let questions = JSON.parse(localStorage.getItem('questions')) || [];
                questions = questions.filter(q => q.id !== questionId);
                localStorage.setItem('questions', JSON.stringify(questions));
                
                loadQuestions(document.querySelector('.tab.active').getAttribute('data-category'));
            }
            
            // Reset question form
            function resetQuestionForm() {
                document.getElementById('question-text').value = '';
                document.getElementById('option-a').value = '';
                document.getElementById('option-b').value = '';
                document.getElementById('option-c').value = '';
                document.getElementById('option-d').value = '';
                document.getElementById('option-e').value = '';
                document.getElementById('correct-answer').value = '0';
                document.getElementById('explanation').value = '';
                document.getElementById('question-image').value = '';
                document.getElementById('cancel-edit').style.display = 'none';
                editingQuestionId = null;
            }
        });
    </script>
</body>
</html>
