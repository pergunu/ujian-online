<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Ujian - PERGUNU Situbondo</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div id="particles-js"></div>
    
    <div class="results-container">
        <div class="logo-container">
            <img src="assets/images/logo.png" alt="Logo PERGUNU Situbondo" class="logo">
        </div>
        
        <div class="results-content">
            <h2>Hasil Ujian Online</h2>
            
            <div class="participant-info">
                <p id="result-name"></p>
                <p id="result-exam"></p>
                <p id="result-date"></p>
            </div>
            
            <div class="score-container">
                <div class="score-circle">
                    <div class="score-value" id="score-value">0</div>
                    <div class="score-label">Nilai</div>
                </div>
                
                <div class="score-details">
                    <div class="detail-item">
                        <span class="detail-label">Jumlah Soal:</span>
                        <span class="detail-value" id="total-questions">0</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Jawaban Benar:</span>
                        <span class="detail-value" id="correct-answers">0</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Jawaban Salah:</span>
                        <span class="detail-value" id="wrong-answers">0</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Tidak Dijawab:</span>
                        <span class="detail-value" id="unanswered">0</span>
                    </div>
                </div>
            </div>
            
            <div class="motivational-message" id="motivational-message">
                Memuat pesan motivasi...
            </div>
            
            <div class="result-actions">
                <button id="view-certificate">Lihat Sertifikat</button>
                <button id="retake-exam">Ulangi Ujian</button>
            </div>
        </div>
    </div>

    <audio id="applause-audio" src="assets/audio/applause.mp3"></audio>

    <script src="assets/js/particles.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize particles
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 },
                    move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "grab" },
                        onclick: { enable: true, mode: "push" },
                        resize: true
                    }
                },
                retina_detect: true
            });
            
            // Load exam results
            const examResults = JSON.parse(localStorage.getItem('examResults'));
            
            if(!examResults) {
                alert('Hasil ujian tidak ditemukan. Silakan ikuti ujian terlebih dahulu.');
                window.location.href = 'index.html';
                return;
            }
            
            // Display results
            document.getElementById('result-name').textContent = `Nama: ${examResults.participant.fullname}`;
            
            if(examResults.examData.type === 'pelajar') {
                document.getElementById('result-exam').textContent = 
                    `Ujian: ${getSubjectName(examResults.examData.subject)} - Kelas ${examResults.examData.grade.toUpperCase()}`;
            } else {
                document.getElementById('result-exam').textContent = 
                    `Ujian: ${getExamTypeName(examResults.examData.examType)}`;
            }
            
            const examDate = new Date(examResults.timestamp);
            document.getElementById('result-date').textContent = 
                `Tanggal Ujian: ${examDate.toLocaleDateString('id-ID')}`;
            
            document.getElementById('total-questions').textContent = examResults.totalQuestions;
            document.getElementById('correct-answers').textContent = examResults.correctAnswers;
            document.getElementById('wrong-answers').textContent = 
                examResults.answers.filter((a, i) => a !== null && a !== examResults.questions[i].correctAnswer).length;
            document.getElementById('unanswered').textContent = 
                examResults.answers.filter(a => a === null).length;
            
            // Animate score
            const scoreValue = document.getElementById('score-value');
            let currentScore = 0;
            const targetScore = examResults.score;
            const scoreIncrement = targetScore / 50;
            
            const scoreInterval = setInterval(() => {
                currentScore += scoreIncrement;
                if(currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(scoreInterval);
                    
                    // Play applause sound when score animation completes
                    document.getElementById('applause-audio').play();
                }
                scoreValue.textContent = Math.round(currentScore);
            }, 20);
            
            // Set motivational message based on score
            const motivationalMessage = document.getElementById('motivational-message');
            let message = '';
            
            if(targetScore >= 90) {
                message = 'Sempurna! Anda sangat luar biasa dalam menguasai materi ini. Pertahankan prestasi ini.';
            } else if(targetScore >= 75) {
                message = 'Hasil yang sangat baik! Anda telah memahami sebagian besar materi dengan baik.';
            } else if(targetScore >= 60) {
                message = 'Hasil yang cukup baik. Tingkatkan lagi pemahaman Anda untuk hasil yang lebih maksimal.';
            } else if(targetScore >= 40) {
                message = 'Anda sudah memulai dengan baik. Pelajari lagi materinya dan coba lagi.';
            } else {
                message = 'Jangan menyerah! Setiap kegagalan adalah pelajaran untuk kesuksesan di masa depan.';
            }
            
            motivationalMessage.textContent = message;
            
            // Button actions
            document.getElementById('view-certificate').addEventListener('click', function() {
                window.location.href = 'certificate.html';
            });
            
            document.getElementById('retake-exam').addEventListener('click', function() {
                if(confirm('Apakah Anda yakin ingin mengulang ujian?')) {
                    window.location.href = 'exam.html';
                }
            });
            
            // Helper functions
            function getSubjectName(subject) {
                const subjects = {
                    'agama': 'Agama',
                    'ppkn': 'PPKN',
                    'sejarah': 'Sejarah',
                    'ipa': 'IPA',
                    'ips': 'IPS',
                    'matematika': 'Matematika',
                    'bahasa-indonesia': 'Bahasa Indonesia',
                    'bahasa-inggris': 'Bahasa Inggris',
                    'materi-extra': 'Materi Extra',
                    'materi-khusus': 'Materi Khusus'
                };
                return subjects[subject] || subject;
            }
            
            function getExamTypeName(examType) {
                const types = {
                    'tes-iq': 'Tes IQ',
                    'ujian-cpns': 'Ujian CPNS/P3K'
                };
                return types[examType] || examType;
            }
        });
    </script>
</body>
</html>
